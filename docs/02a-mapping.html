<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>02a-mapping.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="lesson.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Setup
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="setup.html">Setup</a>
    </li>
    <li>
      <a href="AWSinstuctionsStudents.html">AWS Backup instructions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00-intro.html">Introduction</a>
    </li>
    <li>
      <a href="01a-fundamentals.html">Fundamentals</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01b-dataframes.html">Useful Python packages for different data types</a>
    </li>
    <li>
      <a href="02a-mapping.html">Mapping with Cartopy</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03a-MachineLearning.html">Machine Learning</a>
    </li>
    <li>
      <a href="03b-DeepLearningTS.html">Deep Learning &amp; Time Series</a>
    </li>
    <li>
      <a href="02b-Clustering.html">Numerical approaches</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 4
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04a-SimpleSpeedUps.html">Simple Speed Ups</a>
    </li>
    <li>
      <a href="04b-DaskDataframes.html">Dask data frames</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="mapping-with-cartopy" class="section level1">
<h1>Mapping with Cartopy</h1>
<div id="questions" class="section level3 questions">
<h3>Questions</h3>
<ul>
<li>What plotting options are available in Pyton?</li>
<li>What mapping features are availble in Python?</li>
</ul>
</div>
<div id="objectives" class="section level3 objectives">
<h3>Objectives</h3>
<ul>
<li>Learn different approaches to plots and mapping</li>
<li>Learn about cartopy</li>
</ul>
</div>
<div id="introduction-to-matplotlib" class="section level2">
<h2>Introduction to matplotlib</h2>
<p>A more general interface is available and a more structured approach to using <code>matplotlib</code> is helpful.</p>
<ul>
<li><a href="https://matplotlib.org/3.1.3/Matplotlib.pdf">PDF documentation</a></li>
<li><a href="http://matplotlib.org/gallery.html">Online gallery / cookbook</a></li>
</ul>
<p>Matplotlib fully embraces the python object-oriented model, but for some tasks the design of the object hierarchy is a little bit counter-intuitive. It’s best to find a common pattern for building plots and stick to it.</p>
<pre class="python"><code>import matplotlib.pyplot as plt
import numpy as np</code></pre>
<pre class="python"><code>fig = plt.figure(figsize=(6, 4), facecolor=&quot;none&quot;)

ax = plt.subplot(111) # 1x1 array of plots, ax refers to the 1st of them

# Content is added to the blank axes instance
# ...

fig.savefig(&quot;test-figure.png&quot;, dpi=150)
plt.show()  # happens anyway !</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_3_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code>fig = plt.figure(figsize=(6,6), facecolor=&quot;none&quot;)

ax = plt.subplot(321)   # 3x2 array of plots, ax refers to the 1st of them
ax2 = plt.subplot(322) 

ax3 = plt.subplot(323) 
ax4 = plt.subplot(324) 

ax5 = plt.subplot(325) 
ax6 = plt.subplot(326) # 3x2 array of plots, ax6 refers to the last of them


# Content is added to the blank axes instance
# ...

fig.savefig(&quot;test-figure2.png&quot;, dpi=150)
plt.show()  # happens anyway !</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_4_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code># Demo example

# First, define some synthetic data

x1 = np.linspace(0.0, 5.0)
x2 = np.linspace(0.0, 2.0)

y1 = np.cos(2 * np.pi * x1) * np.exp(-x1)
y2 = np.cos(2 * np.pi * x2)</code></pre>
<pre class="python"><code># Option 1
plt.subplot(211)
plt.plot(x1, y1, &#39;o-&#39;)
plt.title(&#39;A tale of 2 subplots&#39;)
plt.ylabel(&#39;Damped oscillation&#39;)

plt.subplot(212)
plt.plot(x2, y2, &#39;.-&#39;)
plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;Undamped&#39;)

plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_6_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code># My preference - option 2
# Set up the plot

fig = plt.figure(figsize=(6,6), facecolor=&quot;none&quot;)
ax  = plt.subplot(211)   # 2s1 array of plots, ax refers to the 1st of them
ax2 = plt.subplot(212) 

ax.plot(x1, y1, &#39;o-&#39;)
ax.set_title(&#39;A tale of 2 subplots&#39;)
ax.set_ylabel(&#39;Damped oscillation&#39;)

ax2.plot(x2, y2, &#39;.-&#39;)
ax2.set_xlabel(&#39;time (s)&#39;)
ax2.set_ylabel(&#39;Not Damped&#39;)
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_7_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code>&quot;&quot;&quot;
==================
ggplot style sheet
==================

This example demonstrates the &quot;ggplot&quot; style, which adjusts the style to
emulate ggplot_ (a popular plotting package for R_).

These settings were shamelessly stolen from [1]_ (with permission).

.. [1] http://www.huyng.com/posts/sane-color-scheme-for-matplotlib/

.. _ggplot: http://ggplot2.org/
.. _R: https://www.r-project.org/

&quot;&quot;&quot;

plt.style.use(&#39;ggplot&#39;)


# This is another way to set up the axes objects
# and may be preferable, but whichever - choose one and stick with it !

fig, axes = plt.subplots(ncols=2, nrows=2)
ax1, ax2, ax3, ax4 = axes.ravel()
fig.set_size_inches((8,8))

# scatter plot (Note: `plt.scatter` doesn&#39;t use default colors)
x, y = np.random.normal(size=(2, 200))
ax1.plot(x, y, &#39;o&#39;)

# sinusoidal lines with colors from default color cycle
L = 2*np.pi
x = np.linspace(0, L)
ncolors = len(plt.rcParams[&#39;axes.prop_cycle&#39;])
shift = np.linspace(0, L, ncolors, endpoint=False)
for s in shift:
    ax2.plot(x, np.sin(x + s), &#39;-&#39;)
ax2.margins(0)

# bar graphs
x = np.arange(5)
y1, y2 = np.random.randint(1, 25, size=(2, 5))
width = 0.25
ax3.bar(x, y1, width)
ax3.bar(x + width, y2, width,
        color=list(plt.rcParams[&#39;axes.prop_cycle&#39;])[2][&#39;color&#39;])
ax3.set_xticks(x + width)
ax3.set_xticklabels([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;])

# circles with colors from default color cycle
for i, color in enumerate(plt.rcParams[&#39;axes.prop_cycle&#39;]):
    xy = np.random.normal(size=2)
    ax4.add_patch(plt.Circle(xy, radius=0.3, color=color[&#39;color&#39;]))
ax4.axis(&#39;equal&#39;)
ax4.margins(0)

plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_8_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code>
from matplotlib.colors import LightSource, Normalize


def display_colorbar():
    &quot;&quot;&quot;Display a correct numeric colorbar for a shaded plot.&quot;&quot;&quot;
    y, x = np.mgrid[-4:2:200j, -4:2:200j]
    z = 10 * np.cos(x**2 + y**2)

    cmap = plt.cm.copper
    ls = LightSource(315, 45)
    rgb = ls.shade(z, cmap)

    fig, ax = plt.subplots()
    ax.imshow(rgb, interpolation=&#39;bilinear&#39;)

    # Use a proxy artist for the colorbar...
    im = ax.imshow(z, cmap=cmap)
    im.remove()
    fig.colorbar(im)

    ax.set_title(&#39;Using a colorbar with a shaded plot&#39;, size=&#39;x-large&#39;)


def avoid_outliers():
    &quot;&quot;&quot;Use a custom norm to control the displayed z-range of a shaded plot.&quot;&quot;&quot;
    y, x = np.mgrid[-4:2:200j, -4:2:200j]
    z = 10 * np.cos(x**2 + y**2)

    # Add some outliers...
    z[100, 105] = 2000
    z[120, 110] = -9000

    ls = LightSource(315, 45)
    fig, (ax1, ax2) = plt.subplots(ncols=2, figsize=(8, 4.5))

    rgb = ls.shade(z, plt.cm.copper)
    ax1.imshow(rgb, interpolation=&#39;bilinear&#39;)
    ax1.set_title(&#39;Full range of data&#39;)

    rgb = ls.shade(z, plt.cm.copper, vmin=-10, vmax=10)
    ax2.imshow(rgb, interpolation=&#39;bilinear&#39;)
    ax2.set_title(&#39;Manually set range&#39;)

    fig.suptitle(&#39;Avoiding Outliers in Shaded Plots&#39;, size=&#39;x-large&#39;)


def shade_other_data():
    &quot;&quot;&quot;Demonstrates displaying different variables through shade and color.&quot;&quot;&quot;
    y, x = np.mgrid[-4:2:200j, -4:2:200j]
    z1 = np.sin(x**2)  # Data to hillshade
    z2 = np.cos(x**2 + y**2)  # Data to color

    norm = Normalize(z2.min(), z2.max())
    cmap = plt.cm.RdBu

    ls = LightSource(315, 45)
    rgb = ls.shade_rgb(cmap(norm(z2)), z1)

    fig, ax = plt.subplots()
    ax.imshow(rgb, interpolation=&#39;bilinear&#39;)
    ax.set_title(&#39;Shade by one variable, color by another&#39;, size=&#39;x-large&#39;)

display_colorbar()
avoid_outliers()
shade_other_data()
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_9_0.png" alt="" />
<p class="caption">png</p>
</div>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_9_1.png" alt="" />
<p class="caption">png</p>
</div>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_9_2.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code>&quot;&quot;&quot;
Demonstrates the visual effect of varying blend mode and vertical exaggeration
on &quot;hillshaded&quot; plots.

Note that the &quot;overlay&quot; and &quot;soft&quot; blend modes work well for complex surfaces
such as this example, while the default &quot;hsv&quot; blend mode works best for smooth
surfaces such as many mathematical functions.

In most cases, hillshading is used purely for visual purposes, and *dx*/*dy*
can be safely ignored. In that case, you can tweak *vert_exag* (vertical
exaggeration) by trial and error to give the desired visual effect. However,
this example demonstrates how to use the *dx* and *dy* kwargs to ensure that
the *vert_exag* parameter is the true vertical exaggeration.
&quot;&quot;&quot;

from matplotlib.cbook import get_sample_data
from matplotlib.colors import LightSource

dem = np.load(get_sample_data(&#39;jacksboro_fault_dem.npz&#39;, asfileobj= False))
z = dem[&#39;elevation&#39;]

#-- Optional dx and dy for accurate vertical exaggeration --------------------
# If you need topographically accurate vertical exaggeration, or you don&#39;t want
# to guess at what *vert_exag* should be, you&#39;ll need to specify the cellsize
# of the grid (i.e. the *dx* and *dy* parameters).  Otherwise, any *vert_exag*
# value you specify will be relative to the grid spacing of your input data
# (in other words, *dx* and *dy* default to 1.0, and *vert_exag* is calculated
# relative to those parameters).  Similarly, *dx* and *dy* are assumed to be in
# the same units as your input z-values.  Therefore, we&#39;ll need to convert the
# given dx and dy from decimal degrees to meters.
dx, dy = dem[&#39;dx&#39;], dem[&#39;dy&#39;]
dy = 111200 * dy
dx = 111200 * dx * np.cos(np.radians(dem[&#39;ymin&#39;]))
#-----------------------------------------------------------------------------

# Shade from the northwest, with the sun 45 degrees from horizontal
ls = LightSource(azdeg=315, altdeg=45)
cmap = plt.cm.gist_earth

fig, axes = plt.subplots(nrows=4, ncols=3, figsize=(8, 9))
plt.setp(axes.flat, xticks=[], yticks=[])

# Vary vertical exaggeration and blend mode and plot all combinations
for col, ve in zip(axes.T, [0.1, 1, 10]):
    # Show the hillshade intensity image in the first row
    col[0].imshow(ls.hillshade(z, vert_exag=ve, dx=dx, dy=dy), cmap=&#39;gray&#39;)

    # Place hillshaded plots with different blend modes in the rest of the rows
    for ax, mode in zip(col[1:], [&#39;hsv&#39;, &#39;overlay&#39;, &#39;soft&#39;]):
        rgb = ls.shade(z, cmap=cmap, blend_mode=mode,
                       vert_exag=ve, dx=dx, dy=dy)
        ax.imshow(rgb)

# Label rows and columns
for ax, ve in zip(axes[0], [0.1, 1, 10]):
    ax.set_title(&#39;{0}&#39;.format(ve), size=18)
for ax, mode in zip(axes[:, 0], [&#39;Hillshade&#39;, &#39;hsv&#39;, &#39;overlay&#39;, &#39;soft&#39;]):
    ax.set_ylabel(mode, size=18)

# Group labels...
axes[0, 1].annotate(&#39;Vertical Exaggeration&#39;, (0.5, 1), xytext=(0, 30),
                    textcoords=&#39;offset points&#39;, xycoords=&#39;axes fraction&#39;,
                    ha=&#39;center&#39;, va=&#39;bottom&#39;, size=20)
axes[2, 0].annotate(&#39;Blend Mode&#39;, (0, 0.5), xytext=(-30, 0),
                    textcoords=&#39;offset points&#39;, xycoords=&#39;axes fraction&#39;,
                    ha=&#39;right&#39;, va=&#39;center&#39;, size=20, rotation=90)
fig.subplots_adjust(bottom=0.05, right=0.95)

plt.show()

# note - if you get a sample data not found error here run
#  conda install -c conda-forge mpl_sample_data 
# after activating your geopy environment</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_10_0.png" alt="" />
<p class="caption">png</p>
</div>
</div>
<div id="cartopy" class="section level2">
<h2>Cartopy</h2>
<p>Is a mapping and imaging package originating from the Met. Office in the UK. The home page for the package is <a href="http://scitools.org.uk/cartopy/" class="uri">http://scitools.org.uk/cartopy/</a>. Like many python packages, the <a href="http://scitools.org.uk/cartopy/docs/latest/index.html">documentation</a> is patchy and the best way to learn is to try to do things and ask other people who have figured out this and that.</p>
<p>We are going to work through a number of the examples and try to extend them to do the kinds of things you might find interesting and useful in the future. The examples are in the form of a <a href="http://scitools.org.uk/cartopy/docs/latest/gallery.html">gallery</a></p>
<p>You might also want to look at the <a href="http://scitools.org.uk/cartopy/docs/latest/crs/projections.html">list of map projections</a> from time to time. Not all maps can be plotted in every projection (sometimes because of bugs and sometimes because they are not supposed to work for the data you have) but you can try them and see what happens.</p>
<p>Cartopy is built on top of a lot of the matplotlib graphing tools. It works by introducing a series of projections associated with the axes of a graph. On top of that there is a big toolkit for reading in images, finding data from standard web feeds, and manipulating geographical objects. Many, many libraries are involved and sometimes things break. Luckily the installation that is built for this course is about as reliable as we can ever get. I’m just warning you, though, that it can be quite tough if you want to put this on your laptop from scratch.</p>
<p>We have a number of imports that we will need almost every time.</p>
<p>If we are going to plot anything then we need to include <strong>matplotlib</strong>.</p>
<pre class="python"><code>import cartopy
import cartopy.crs as ccrs</code></pre>
<pre class="python"><code>import cartopy.crs as ccrs
import matplotlib.pyplot as plt

ax = plt.axes(projection=ccrs.PlateCarree())
ax.stock_img()
ax.coastlines()
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_14_0.png" alt="" />
<p class="caption">png</p>
</div>
<p>The simplest plot: global map using the default image built into the package and adding coastlines</p>
<pre class="python"><code>
fig = plt.figure(figsize=(12, 12))
ax  = plt.axes(projection=ccrs.Mercator())

    # make the map global rather than have it zoom in to
    # the extents of any plotted data
    
ax.set_global()
ax.coastlines()  
ax.stock_img()

plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_16_0.png" alt="" />
<p class="caption">png</p>
</div>
<p>Try changing the projection - either look at the list in the link I gave you above or use the tab-completion feature of iPython to see what <code>ccrs</code> has available ( not everything will be a projection, but you can see what works and what breaks ).</p>
<p>Here is how you can plot a region instead of the globe:</p>
<pre class="python"><code>fig = plt.figure(figsize=(12, 12))
ax  = plt.axes(projection=ccrs.Robinson())    
ax.set_extent([0, 40, 28, 48])

ax.coastlines(resolution=&#39;50m&#39;)  
ax.stock_img()
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_18_0.png" alt="" />
<p class="caption">png</p>
</div>
<pre class="python"><code>help(ax.stock_img)</code></pre>
<pre><code>Help on method stock_img in module cartopy.mpl.geoaxes:

stock_img(name=&#39;ne_shaded&#39;) method of cartopy.mpl.geoaxes.GeoAxesSubplot instance
    Add a standard image to the map.
    
    Currently, the only (and default) option is a downsampled version of
    the Natural Earth shaded relief raster.</code></pre>
<div id="challenge" class="section level3 challenge">
<h3>Challenge</h3>
<ul>
<li>Make a Mollweide plot of Australia.</li>
</ul>
<details>
<summary>
Solution
</summary>
<pre class="python"><code>fig = plt.figure(figsize=(12, 12), facecolor=&quot;none&quot;)
ax  = plt.axes(projection=ccrs.Mollweide(central_longitude=130))
ax.set_extent([112, 153, -43, -10]) 

ax.coastlines(resolution=&#39;50m&#39;)  
ax.stock_img()
plt.show()</code></pre>
</details>
</div>
<div id="netcdf-data-and-more-cartopy" class="section level3">
<h3>NetCDF data and more Cartopy</h3>
<pre class="python"><code>#We use the scipy netcdf reader
import scipy.io</code></pre>
<pre class="python"><code>#Set the file name and read in the data
filename=&quot;../data/topodata.nc&quot;
data = scipy.io.netcdf.netcdf_file(filename,&#39;r&#39;)

#Netcdf could be stored with multiple different formats
#Print out these data
data.variables</code></pre>
<pre><code>OrderedDict([(&#39;X&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x7fad40e1a490&gt;),
             (&#39;Y&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x7fad40d9afd0&gt;),
             (&#39;elev&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x7fad40d9a640&gt;)])</code></pre>
<pre class="python"><code>#Set each layer as a variable
worldbath=data.variables[&#39;elev&#39;][:]
lons=data.variables[&#39;X&#39;][:]
lats=data.variables[&#39;Y&#39;][:]</code></pre>
<pre class="python"><code>print(worldbath.shape)
print(lons.shape)
print(lats.shape)</code></pre>
<pre><code>(2160, 4320)
(4320,)
(2160,)</code></pre>
<pre class="python"><code>#A quick plot of the main dataset
plt.pcolormesh(worldbath)
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_26_0.png" alt="" />
<p class="caption">png</p>
</div>
<p>matplotlib lib has no native understaning of geocentric coordinate systems. Cartopy does.</p>
<p>matplotlib commands with “x” and “y” values of latitudes and longitudes make sense too!</p>
<pre class="python"><code>#A more earthly plot of the data
fig = plt.figure(figsize=(6, 6))
ax = plt.axes(projection=ccrs.Orthographic(-10, 45))
ax.pcolormesh(lons,lats,worldbath, transform=ccrs.PlateCarree())
plt.show()</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_28_0.png" alt="" />
<p class="caption">png</p>
</div>
<p>This is fairly high resolution for what we are looking at, so we could downsample the grid to save some time. Also, not all grids are global, so we can subset the data to represent perhaps a small area we may have a grid/image over.</p>
<pre class="python"><code>#Take a subset of the data by slicing the array with indexing
subbath=worldbath[1200:1650:2,1300:1900:2]
#Take the corresponding lat/lon values as the main data array
sublons=lons[1300:1900:2]
sublats=lats[1200:1650:2]</code></pre>
<pre class="python"><code>#Make the figure object
fig = plt.figure(figsize=(8, 8),dpi=300)

#Create the main plot axes
ax = plt.axes(projection=ccrs.Mollweide(central_longitude=130))

#Plot the data on the axes
mapdat=ax.pcolormesh(sublons,sublats,subbath, 
              transform=ccrs.PlateCarree(),cmap=plt.cm.gist_earth,vmax=1000,vmin=-6000)

#Add background oceans, land
#ax.add_feature(cartopy.feature.OCEAN, zorder=0)
#ax.add_feature(cartopy.feature.LAND, zorder=0, edgecolor=&#39;blue&#39;)  

#Add Gridlines
gl=ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,
             linewidth=0.1, color=&#39;gray&#39;, alpha=0.5, linestyle=&#39;-&#39;,
             x_inline=False, y_inline=False)

gl.top_labels = False
gl.bottom_labels = True
gl.right_labels = False
gl.left_labels = True

gl.xlabel_style = {&#39;size&#39;: 8, &#39;color&#39;: &#39;gray&#39;}
gl.ylabel_style = {&#39;size&#39;: 8, &#39;color&#39;: &#39;gray&#39;}


#Add a colorbar axes
cbaxes = fig.add_axes([0.60, 0.22, 0.2, 0.015],frameon=True,facecolor=&#39;white&#39;)

#Add the colorbar to the axes with the data
cbar = plt.colorbar(mapdat, cax = cbaxes,orientation=&quot;horizontal&quot;,extend=&#39;both&#39;)

#Fix additional options of the colorbar
cbar.set_label(&#39;Height (m)&#39;, labelpad=-40,fontsize=8,color=&#39;white&#39;)
cbar.ax.set_xticklabels([-5000,-2500,0,1000],color=&#39;white&#39;,fontsize=8)

#Show the plot!
plt.show()</code></pre>
<pre><code>&lt;ipython-input-23-3d2618499013&gt;:37: UserWarning: FixedFormatter should only be used together with FixedLocator
  cbar.ax.set_xticklabels([-5000,-2500,0,1000],color=&#39;white&#39;,fontsize=8)</code></pre>
<div class="figure">
<img src="02a-mapping_files/02a-mapping_31_1.png" alt="" />
<p class="caption">png</p>
</div>
</div>
<div id="challenge-1" class="section level3 challenge">
<h3>Challenge</h3>
<ul>
<li>Re-make the last map, but with the full topo dataset.</li>
<li>Crop the image.</li>
<li>Add coastlines back in.</li>
<li>Pick a different color scale.</li>
<li>Move the colorbar to the bottom left.</li>
</ul>
<details>
<summary>
Solution
</summary>
<pre class="python"><code>#Still make the subsets, but at full res, otherwise plot takes long time
subbath=worldbath[1200:1650,1300:1900]
sublons=lons[1300:1900]
sublats=lats[1200:1650]

#Make the figure object
fig = plt.figure(figsize=(8, 8),dpi=300)

#Create the main plot axes
ax = plt.axes(projection=ccrs.Mollweide(central_longitude=130))

#Plot the data on the axes
mapdat=ax.pcolormesh(sublons,sublats,subbath, 
              transform=ccrs.PlateCarree(),cmap=plt.cm.terrain,vmax=1000,vmin=-6000)

#Add coastlines, restrict the image to an extent
ax.coastlines(resolution=&#39;50m&#39;,color=&#39;black&#39;)
ax.set_extent([112, 153, -43, -10])    

#Add Gridlines
gl=ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,
             linewidth=0.1, color=&#39;gray&#39;, alpha=0.5, linestyle=&#39;-&#39;,
             x_inline=False, y_inline=False)

gl.top_labels = True
gl.bottom_labels = False
gl.right_labels = False
gl.left_labels = True
gl.xlabel_style = {&#39;size&#39;: 8, &#39;color&#39;: &#39;gray&#39;}
gl.ylabel_style = {&#39;size&#39;: 8, &#39;color&#39;: &#39;gray&#39;}

#Add a colorbar axes
cbaxes = fig.add_axes([0.20, 0.22, 0.2, 0.015],frameon=True,facecolor=&#39;white&#39;)

#Add the colorbar to the axes with the data
cbar = plt.colorbar(mapdat, cax = cbaxes,orientation=&quot;horizontal&quot;,extend=&#39;both&#39;)

#Fix additional options of the colorbar
cbar.set_label(&#39;Height (m)&#39;, labelpad=-40,fontsize=8,color=&#39;white&#39;)
cbar.ax.set_xticklabels([-5000,-2500,0,1000],color=&#39;white&#39;,fontsize=8)

#Show the plot!
plt.show()</code></pre>
</details>
</div>
<pre class="python"><code></code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
