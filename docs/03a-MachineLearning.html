<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>03a-MachineLearning.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="lesson.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Setup
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="setup.html">Setup</a>
    </li>
    <li>
      <a href="AWSinstuctionsStudents.html">AWS Backup instructions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00-intro.html">Introduction</a>
    </li>
    <li>
      <a href="01a-fundamentals.html">Fundamentals</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01b-dataframes.html">Useful Python packages for different data types</a>
    </li>
    <li>
      <a href="02a-mapping.html">Mapping with Cartopy</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 3
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03a-MachineLearning.html">Machine Learning</a>
    </li>
    <li>
      <a href="03b-DeepLearningTS.html">Deep Learning &amp; Time Series</a>
    </li>
    <li>
      <a href="02b-Clustering.html">Numerical approaches</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Session 4
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04a-SimpleSpeedUps.html">Simple Speed Ups</a>
    </li>
    <li>
      <a href="04b-DaskDataframes.html">Dask data frames</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="machine-learning-for-geoscience" class="section level1">
<h1>Machine Learning for Geoscience</h1>
<div id="questions" class="section level3 questions">
<h3>Questions</h3>
<ul>
<li>What data science tools and techniques can be used in Python?</li>
<li>How do I do it?</li>
</ul>
</div>
<div id="objectives" class="section level3 objectives">
<h3>Objectives</h3>
<ul>
<li>Learn fundamental Machine Learning packages.</li>
<li>Learn to further explore data.</li>
</ul>
</div>
<p>Let’s use some standard Machine Learning tools available in Python packages to analyse some data.</p>
<p>We have a dataset (from Butterworth et al. 2016) with a collection of tectonomagmatic parameters associated with the time and location of porphyry copper deposits. We want to determine which of these (if any) parameters are geologically important (or at least statistically significant) in relation to the formation of porphyry coppers.</p>
<p>Below is an animation of the tectonomagmatic evolution of the South American plate margin since 150Ma, representing many of the parameters in the data.</p>
<div class="figure">
<img src="fig/MullerConvergenceSmall.gif" title="segment" alt="" />
<p class="caption">SegmentLocal</p>
</div>
<div id="start-by-importing-most-of-the-modules-we-need" class="section level2">
<h2>Start by importing most of the modules we need</h2>
<p>By convention module loads go at the top of your workflows.</p>
<pre class="python"><code>import pandas #For dealing with data structures
import numpy as np #Data array manipulation
import scipy #Scientific Python, has lots of useful tools
import scipy.io #A specific sub-module for input/output of sci data

#scikit-learn tools to perform machine learning classification
#from sklearn import cross_validation
from sklearn.model_selection import train_test_split
from sklearn.model_selection import cross_val_score
from sklearn.svm import SVC
from sklearn.ensemble import RandomForestClassifier
from sklearn import preprocessing

#For making pretty figures
import matplotlib.pyplot as plt 
from matplotlib import cm

#For easy geographic projections on a map
import cartopy.crs as ccrs

#For dealing with shapefiles
import shapefile
</code></pre>
<div id="now-load-in-the-data" class="section level3">
<h3>Now load in the data</h3>
<pre class="python"><code>#Use pandas to load in the machine learning dataset
ml_data=pandas.read_csv(&quot;../data/ml_data_points.csv&quot;,index_col=0)</code></pre>
<pre class="python"><code>#Print out the dataset so we can see what it looks like
ml_data</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
0 Present day longitude (degrees)
</th>
<th>
1 Present day latitude (degrees)
</th>
<th>
2 Reconstructed longitude (degrees)
</th>
<th>
3 Reconstructed latitude (degrees)
</th>
<th>
4 Age (Ma)
</th>
<th>
5 Time before mineralisation (Myr)
</th>
<th>
6 Seafloor age (Myr)
</th>
<th>
7 Segment length (km)
</th>
<th>
8 Slab length (km)
</th>
<th>
9 Distance to trench edge (km)
</th>
<th>
…
</th>
<th>
11 Subducting plate parallel velocity (km/Myr)
</th>
<th>
12 Overriding plate normal velocity (km/Myr)
</th>
<th>
13 Overriding plate parallel velocity (km/Myr)
</th>
<th>
14 Convergence normal rate (km/Myr)
</th>
<th>
15 Convergence parallel rate (km/Myr)
</th>
<th>
16 Subduction polarity (degrees)
</th>
<th>
17 Subduction obliquity (degrees)
</th>
<th>
18 Distance along margin (km)
</th>
<th>
19 Subduction obliquity signed (radians)
</th>
<th>
20 Ore Deposits Binary Flag (1 or 0)
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
-66.28
</td>
<td>
-27.37
</td>
<td>
-65.264812
</td>
<td>
-28.103781
</td>
<td>
6.0
</td>
<td>
0.0
</td>
<td>
48.189707
</td>
<td>
56.08069
</td>
<td>
2436.30907
</td>
<td>
2436.30907
</td>
<td>
…
</td>
<td>
40.63020
</td>
<td>
-17.43987
</td>
<td>
12.20271
</td>
<td>
102.31471
</td>
<td>
28.82518
</td>
<td>
5.67505
</td>
<td>
15.73415
</td>
<td>
2269.19769
</td>
<td>
0.274613
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
-69.75
</td>
<td>
-30.50
</td>
<td>
-67.696759
</td>
<td>
-31.970639
</td>
<td>
12.0
</td>
<td>
0.0
</td>
<td>
52.321162
</td>
<td>
56.09672
</td>
<td>
2490.68735
</td>
<td>
2490.68735
</td>
<td>
…
</td>
<td>
39.60199
</td>
<td>
-22.80622
</td>
<td>
13.40127
</td>
<td>
115.35820
</td>
<td>
27.39401
</td>
<td>
5.78937
</td>
<td>
13.35854
</td>
<td>
1823.34107
</td>
<td>
0.233151
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
-66.65
</td>
<td>
-27.27
</td>
<td>
-65.128689
</td>
<td>
-28.374772
</td>
<td>
9.0
</td>
<td>
0.0
</td>
<td>
53.506085
</td>
<td>
55.77705
</td>
<td>
2823.54951
</td>
<td>
2823.54951
</td>
<td>
…
</td>
<td>
45.32425
</td>
<td>
-18.08485
</td>
<td>
11.27500
</td>
<td>
100.24282
</td>
<td>
34.62444
</td>
<td>
8.97218
</td>
<td>
19.05520
</td>
<td>
2269.19769
</td>
<td>
0.332576
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
3
</th>
<td>
-66.61
</td>
<td>
-27.33
</td>
<td>
-65.257928
</td>
<td>
-28.311094
</td>
<td>
8.0
</td>
<td>
0.0
</td>
<td>
51.317135
</td>
<td>
55.90088
</td>
<td>
2656.71724
</td>
<td>
2656.71724
</td>
<td>
…
</td>
<td>
43.13319
</td>
<td>
-17.78538
</td>
<td>
11.72618
</td>
<td>
101.21965
</td>
<td>
31.92962
</td>
<td>
7.42992
</td>
<td>
17.50782
</td>
<td>
2269.19769
</td>
<td>
0.305569
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
4
</th>
<td>
-66.55
</td>
<td>
-27.40
</td>
<td>
-65.366917
</td>
<td>
-28.257580
</td>
<td>
7.0
</td>
<td>
0.0
</td>
<td>
49.340097
</td>
<td>
56.09011
</td>
<td>
2547.29585
</td>
<td>
2547.29585
</td>
<td>
…
</td>
<td>
40.57322
</td>
<td>
-17.43622
</td>
<td>
12.23778
</td>
<td>
102.25748
</td>
<td>
28.80235
</td>
<td>
5.65657
</td>
<td>
15.73067
</td>
<td>
2269.19769
</td>
<td>
0.274552
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
296
</th>
<td>
-78.67
</td>
<td>
-6.73
</td>
<td>
-70.657487
</td>
<td>
-11.057387
</td>
<td>
39.0
</td>
<td>
0.0
</td>
<td>
62.727249
</td>
<td>
56.14919
</td>
<td>
5373.67650
</td>
<td>
1076.30110
</td>
<td>
…
</td>
<td>
13.21524
</td>
<td>
-25.08597
</td>
<td>
12.24246
</td>
<td>
60.45651
</td>
<td>
-7.46828
</td>
<td>
-22.30925
</td>
<td>
7.04216
</td>
<td>
4708.08568
</td>
<td>
-0.122909
</td>
<td>
0.0
</td>
</tr>
<tr>
<th>
297
</th>
<td>
-75.09
</td>
<td>
-13.69
</td>
<td>
-37.112536
</td>
<td>
-19.124363
</td>
<td>
121.0
</td>
<td>
0.0
</td>
<td>
30.740063
</td>
<td>
54.09642
</td>
<td>
269.79929
</td>
<td>
269.79929
</td>
<td>
…
</td>
<td>
-39.68330
</td>
<td>
11.56758
</td>
<td>
7.99788
</td>
<td>
-19.41449
</td>
<td>
-59.05957
</td>
<td>
-46.36908
</td>
<td>
71.80290
</td>
<td>
3761.82099
</td>
<td>
1.253197
</td>
<td>
0.0
</td>
</tr>
<tr>
<th>
298
</th>
<td>
-71.31
</td>
<td>
-14.91
</td>
<td>
-38.398992
</td>
<td>
-21.934657
</td>
<td>
151.0
</td>
<td>
0.0
</td>
<td>
17.739843
</td>
<td>
53.93117
</td>
<td>
323.86191
</td>
<td>
323.86191
</td>
<td>
…
</td>
<td>
-3.42257
</td>
<td>
-17.25992
</td>
<td>
-22.78837
</td>
<td>
8.88338
</td>
<td>
-7.68381
</td>
<td>
-40.99490
</td>
<td>
40.85864
</td>
<td>
3378.69739
</td>
<td>
-0.713118
</td>
<td>
0.0
</td>
</tr>
<tr>
<th>
299
</th>
<td>
-70.61
</td>
<td>
-17.25
</td>
<td>
-37.243172
</td>
<td>
-24.160112
</td>
<td>
145.0
</td>
<td>
0.0
</td>
<td>
11.744395
</td>
<td>
53.94534
</td>
<td>
163.59542
</td>
<td>
163.59542
</td>
<td>
…
</td>
<td>
-2.26253
</td>
<td>
14.87833
</td>
<td>
0.05195
</td>
<td>
2.36178
</td>
<td>
-23.78566
</td>
<td>
-38.97366
</td>
<td>
84.32944
</td>
<td>
3160.06366
</td>
<td>
-1.471826
</td>
<td>
0.0
</td>
</tr>
<tr>
<th>
300
</th>
<td>
-76.13
</td>
<td>
-11.60
</td>
<td>
-43.993914
</td>
<td>
-16.965040
</td>
<td>
101.0
</td>
<td>
0.0
</td>
<td>
35.880790
</td>
<td>
54.85460
</td>
<td>
1190.90698
</td>
<td>
1190.90698
</td>
<td>
…
</td>
<td>
40.29418
</td>
<td>
-31.96652
</td>
<td>
41.93348
</td>
<td>
71.76161
</td>
<td>
-29.57451
</td>
<td>
-38.50603
</td>
<td>
22.39762
</td>
<td>
4093.90633
</td>
<td>
-0.390912
</td>
<td>
0.0
</td>
</tr>
</tbody>
</table>
<p>
301 rows × 21 columns
</p>
</div>
<p>There are 21 columns (python (usually) counts from 0) representing different parameters. Some of these parameters may be useful for us. Some are not. The final column contains a binary flag representing whether there is a known porphyry copper deposit at that location or not. The “non-deposits” are required to train our Machine Learning classifier what a porphyry deposit looks like, and also, what a porphyry deposit doesn’t look like!</p>
</div>
<div id="now-lets-perform-our-machine-learning-binary-classification." class="section level3">
<h3>Now let’s perform our machine learning binary classification.</h3>
<pre class="python"><code>#Change data format to numpy array for easy manipulation
ml_data_np=ml_data.values

#Set the indices of the parameters (features) to include in the ML
params=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
# Alternatively try any 4 features you&#39;d like to include!
#params=[6,9,14,17] 


#Save the number of parameters we have chosen
datalength=len(params)

#Normalise the data for Machine Learning
ml_data_norm=preprocessing.scale(ml_data_np[:,params])

#Create a &#39;feature vector&#39; and a &#39;target classification vector&#39;
features=ml_data_norm
targets=ml_data_np[:,20]

#Print out some info about our final dataset
print(&quot;Shape of ML data array: &quot;, ml_data_norm.shape)
print(&quot;Positive (deposits) examples: &quot;,np.shape(ml_data_np[ml_data_np[:,20]==1,:]))
print(&quot;Negative (non-deposits) examples: &quot;,np.shape(ml_data_np[ml_data_np[:,20]==0,:]))</code></pre>
<pre><code>Shape of ML data array:  (301, 21)
Positive (deposits) examples:  (147, 21)
Negative (non-deposits) examples:  (154, 21)</code></pre>
<pre class="python"><code>print(&#39;Make the classifiers&#39;)

print(&#39;Random Forest...&#39;)
#create and train the random forest
#multi-core CPUs can use: rf = RandomForestClassifier(n_estimators=100, n_jobs=2)
#n_estimators use between 64-128 doi: 10.1007/978-3-642-31537-4_13
rf = RandomForestClassifier(n_estimators=128, n_jobs=1,class_weight=None)
rf.fit(features,targets)
print(&quot;Done RF&quot;)

scores = cross_val_score(rf, features,targets, cv=10)
print(&quot;RF Scores: &quot;,scores)
print(&quot;SCORE Mean: %.2f&quot; % np.mean(scores), &quot;STD: %.2f&quot; % np.std(scores), &quot;\n&quot;)

print(&quot;Targets (expected result):&quot;)
print(targets)

print(&quot;Prediction (actual result):&quot;)
print(rf.predict(features))</code></pre>
<pre><code>Make the classifiers
Random Forest...
Done RF
RF Scores:  [1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]
SCORE Mean: 1.00 STD: 0.00 

Targets (expected result):
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
Prediction (actual result):
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]</code></pre>
<pre class="python"><code>#Make a list of labels for our chosen features
paramColumns=np.array(ml_data.columns)
paramLabels=paramColumns[params].tolist()

#Create a new figure
fig, ax = plt.subplots()

#Plot the bar graph
rects=ax.barh(np.arange(0, datalength, step=1),rf.feature_importances_)

#Label the axes
ax.set_yticks(np.arange(0, datalength, step=1))
ax.set_yticklabels(paramLabels)
ax.set_xlabel(&#39;Feature Importance&#39;)

#Print the feature importance to compare with plot
np.set_printoptions(precision=3,suppress=True)
print(&quot;Importance \t Feature&quot;)
for i,label in enumerate(paramLabels):
    print(&quot;%1.3f \t\t %s&quot; % (rf.feature_importances_[i],label))

plt.show()
</code></pre>
<pre><code>Importance   Feature
0.012        0 Present day longitude (degrees)
0.011        1 Present day latitude (degrees)
0.051        2 Reconstructed longitude (degrees)
0.015        3 Reconstructed latitude (degrees)
0.058        4 Age (Ma)
0.000        5 Time before mineralisation (Myr)
0.037        6 Seafloor age (Myr)
0.014        7 Segment length (km)
0.027        8 Slab length (km)
0.026        9 Distance to trench edge (km)
0.017        10 Subducting plate normal velocity (km/Myr)
0.010        11 Subducting plate parallel velocity (km/Myr)
0.021        12 Overriding plate normal velocity (km/Myr)
0.012        13 Overriding plate parallel velocity (km/Myr)
0.021        14 Convergence normal rate (km/Myr)
0.011        15 Convergence parallel rate (km/Myr)
0.011        16 Subduction polarity (degrees)
0.025        17 Subduction obliquity (degrees)
0.008        18 Distance along margin (km)
0.016        19 Subduction obliquity signed (radians)
0.598        20 Ore Deposits Binary Flag (1 or 0)</code></pre>
<div class="figure">
<img src="03a-MachineLearning_files/03a-MachineLearning_11_1.png" alt="" />
<p class="caption">png</p>
</div>
<p>Now if we can measure the tectonomagmatic properties at some point. Based on our trained classifier we can predict a probability that porphyry copper deposits have formed</p>
<pre class="python"><code>#Apply the trained ML to our gridded data to determine the probabilities at each of the points
print(&#39;RF...&#39;)
pRF=np.array(rf.predict_proba(features))
print(&quot;Done RF&quot;)</code></pre>
<pre><code>RF...
Done RF</code></pre>
</div>
</div>
<div id="maps" class="section level2">
<h2>Maps!</h2>
<pre class="python"><code>filename=&quot;../data/topodata.nc&quot;
data = scipy.io.netcdf.netcdf_file(filename,&#39;r&#39;)

data.variables</code></pre>
<pre><code>OrderedDict([(&#39;X&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x269572f8f48&gt;),
             (&#39;Y&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x269572f82c8&gt;),
             (&#39;elev&#39;, &lt;scipy.io.netcdf.netcdf_variable at 0x269551f4788&gt;)])</code></pre>
<pre class="python"><code>topoX=data.variables[&#39;X&#39;][:]
topoY=data.variables[&#39;Y&#39;][:]
topoZ=np.array(data.variables[&#39;elev&#39;][:])

#Some file types and readers (like netcdf) can actually change the data directly on disk
#Good practice, is to close the file when done (for safety and memory saving)
data.close()</code></pre>
<pre><code>c:\users\nbutter\miniconda3\envs\geopy\lib\site-packages\scipy\io\netcdf.py:317: RuntimeWarning: Cannot close a netcdf_file opened with mmap=True, when netcdf_variables or arrays referring to its data still exist. All data arrays obtained from such files refer directly to data on disk, and must be copied before the file can be cleanly closed. (See netcdf_file docstring for more information on mmap.)
  ), category=RuntimeWarning)</code></pre>
<pre class="python"><code>#Make a figure object
plt.figure()

#Get the axes of the current figure, for manipulation
ax = plt.gca()

#Put down the main topography dataset
im=ax.imshow(topoZ,vmin=-5000,vmax=1000,extent=[0,360,-90,90],origin=&#39;upper&#39;,aspect=1,cmap=cm.gist_earth)

#Make a colorbar
cbar=plt.colorbar(im,fraction=0.025,pad=0.05,ticks=[-5000,0, 1000],extend=&#39;both&#39;)
cbar.set_label(&#39;Height \n ASL \n (m)&#39;, rotation=0)

#Clean up the default axis ticks
plt.yticks([-90,-45,0,45,90])
plt.xticks([0,90,180,270,360])

#Put labels on the figure
ax.set_xlabel(&#39;Longitude&#39;)
ax.set_ylabel(&#39;Latitude&#39;)

#Put a title on it
plt.title(&quot;Bathymetry and Topography of the World \n (ETOPO5 2020)&quot;)

plt.show()</code></pre>
<div class="figure">
<img src="03a-MachineLearning_files/03a-MachineLearning_17_0.png" alt="" />
<p class="caption">png</p>
</div>
<div id="for-loops-plotting-shapefiles" class="section level3">
<h3>For loops plotting shapefiles</h3>
<pre class="python"><code>#Load in plate polygons for plotting
topologyFile=&#39;../data/platepolygons/topology_platepolygons_0.00Ma.shp&#39;

#read in the file
shapeRead = shapefile.Reader(topologyFile)

#And save out some of the shape file attributes
recs    = shapeRead.records()
shapes  = shapeRead.shapes()
fields  = shapeRead.fields
Nshp    = len(shapes)

for i, nshp in enumerate(range(Nshp)):
    #if nshp!=35 and nshp!=36 and nshp!=23:
    #These are the plates that cross the dateline and cause 
        #banding errors
        polygonShape=shapes[nshp].points
        poly=np.array(polygonShape)
        plt.plot(poly[:,0], poly[:,1], c=&#39;k&#39;,zorder=1)
        
plt.show()</code></pre>
<div class="figure">
<img src="03a-MachineLearning_files/03a-MachineLearning_19_0.png" alt="" />
<p class="caption">png</p>
</div>
</div>
<div id="make-a-prettier-map" class="section level3">
<h3>Make a prettier map</h3>
<pre class="python"><code>###Set up the figure
fig = plt.figure(figsize=(16,12),dpi=150)

ax = plt.axes(projection=ccrs.PlateCarree())
ax.set_extent([-85, -30, -55, 10])
ax.coastlines(&#39;50m&#39;, linewidth=0.8)

###Add the map grid lines and format them
gl = ax.gridlines(crs=ccrs.PlateCarree(), draw_labels=True,
                  linewidth=2, color=&#39;gray&#39;, alpha=0.5, linestyle=&#39;-&#39;)

from cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER
import matplotlib.ticker as mticker
from matplotlib import colorbar, colors

gl.top_labels = False
gl.left_labels = True
gl.right_labels = False
gl.xlines = False
gl.ylines = False
gl.xlocator = mticker.FixedLocator([-75,-60, -45,-30])
gl.ylocator = mticker.FixedLocator([-60, -45, -30, -15, 0,15])
gl.xformatter = LONGITUDE_FORMATTER
gl.yformatter = LATITUDE_FORMATTER
#gl.xlabel_style = {&#39;size&#39;: 15, &#39;color&#39;: &#39;gray&#39;}
#gl.xlabel_style = {&#39;color&#39;: &#39;black&#39;, &#39;weight&#39;: &#39;normal&#39;}

print(&quot;Made base map&quot;)

###Plot a topography underlay image
#Make a lat lon grid to fit the topo grid
lons, lats = np.meshgrid(topoX,topoY)
im1=ax.pcolormesh(lons,lats,topoZ, shading=&quot;auto&quot;,cmap=plt.cm.gist_earth,transform=ccrs.PlateCarree())              
cbar=plt.colorbar(im1, ax=ax, orientation=&quot;horizontal&quot;, pad=0.02, fraction=0.05, shrink=0.2,extend=&#39;both&#39;)
cbar.set_label(&#39;Topography (m)&#39;)

print(&quot;Added topo&quot;)

###Plot shapefile polygon outlines
#Load in plate polygons for plotting
topologyFile=&#39;../data/platepolygons/topology_platepolygons_0.00Ma.shp&#39;

#read in the file
shapeRead = shapefile.Reader(topologyFile)

#And save out some of the shape file attributes
recs    = shapeRead.records()
shapes  = shapeRead.shapes()
fields  = shapeRead.fields
Nshp    = len(shapes)

for i, nshp in enumerate(range(Nshp)):
    if nshp!=35 and nshp!=36 and nshp!=23:
    #These are the plates that cross the dateline and cause 
        #banding errors
        polygonShape=shapes[nshp].points
        poly=np.array(polygonShape)
        xh=poly[:,0]
        yh=poly[:,1]
        ax.plot(xh, yh, c=&#39;w&#39;,zorder=1)

print(&quot;Added shapes&quot;)
        
###Plot the ore deposit probability
xh = ml_data_np[ml_data_np[:,-1]==1,0]
yh= ml_data_np[ml_data_np[:,-1]==1,1]
l2 = ax.scatter(xh, yh, 500, marker=&#39;.&#39;,c=pRF[:147,1],cmap=plt.cm.copper,zorder=3,transform=ccrs.PlateCarree(),vmin=0,vmax=1)
#l2 = pmap.scatter(xh, yh, 20, marker=&#39;.&#39;,edgecolor=&#39;dimgrey&#39;,linewidth=0.5,c=pRF[:147,1],cmap=plt.cm.copper,zorder=3)
cbar=fig.colorbar(l2, ax=ax, orientation=&quot;horizontal&quot;, pad=0.05, fraction=0.05, shrink=0.2,ticks=[0,0.5,1.0])
l2.set_clim(-0.1, 1.1)
cbar.set_label(&#39;Prediction Probability (%)&#39;)

###Plot the ore deposit Age
xh=ml_data_np[ml_data_np[:,-1]==1,0]
yh = ml_data_np[ml_data_np[:,-1]==1,1]
l2 = ax.scatter(xh, yh, 50, marker=&#39;.&#39;,c=ml_data_np[ml_data_np[:,-1]==1,4],cmap=plt.cm.hsv,zorder=3)
cbar=fig.colorbar(l2, ax=ax, orientation=&quot;horizontal&quot;, pad=0.1, fraction=0.05, shrink=0.2,extend=&#39;max&#39;,ticks=[0,50,100,150])
l2.set_clim(0, 170)
cbar.set_label(&#39;Age of Deposit (Ma)&#39;)

print(&quot;Added deposit probability&quot;)

plt.show()</code></pre>
<pre><code>Made base map
Added topo
Added shapes
Added deposit probability</code></pre>
<div class="figure">
<img src="03a-MachineLearning_files/03a-MachineLearning_21_1.png" alt="" />
<p class="caption">png</p>
</div>
</div>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Do the same analysis but using a different Machine Learning algorithm for your classification. You can use this as a guide for picking a good classification algorithm <a href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html</a>. Present your results on a map, and compare it with the Random Forest method.</p>
</div>
<div id="datasets" class="section level2">
<h2>Datasets</h2>
<div id="topographybathymetry" class="section level4">
<h4>Topography/Bathymetry</h4>
<p>WORLDBATH: ETOPO5 5x5 minute Navy bathymetry. <a href="http://iridl.ldeo.columbia.edu/SOURCES/.NOAA/.NGDC/.ETOPO5/" class="uri">http://iridl.ldeo.columbia.edu/SOURCES/.NOAA/.NGDC/.ETOPO5/</a></p>
</div>
<div id="ml-dataset" class="section level4">
<h4>ML dataset</h4>
<p>Butterworth et al 2016 <a href="https://doi.org/10.1002/2016TC004289" class="uri">https://doi.org/10.1002/2016TC004289</a></p>
</div>
<div id="shapefile-plate-polygons" class="section level4">
<h4>Shapefile plate polygons</h4>
<p>GPlates2.0. <a href="https://www.gplates.org/" class="uri">https://www.gplates.org/</a></p>
</div>
<div id="key-points" class="section level3 keypoints">
<h3>Key points</h3>
<ul>
<li>Applying ML workflows</li>
<li>Wrangling data.</li>
</ul>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
