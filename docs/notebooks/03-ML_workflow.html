<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sydney Informatics Hub Python for Geoscience - Machine Learning (ML) From Scratch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../lesson.css">
</head>

<body class="nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub Python for Geoscience</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-setup" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Setup</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-setup">    
        <li>
    <a class="dropdown-item" href="../setup.html" rel="" target="">
 <span class="dropdown-text">Setup Instructions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/PathsEnvironments.html" rel="" target="">
 <span class="dropdown-text">Paths, Environments, and Notebooks</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">    
        <li>
    <a class="dropdown-item" href="../00-intro.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/01a-fundamentals.html" rel="" target="">
 <span class="dropdown-text">Fundamentals</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">    
        <li>
    <a class="dropdown-item" href="../notebooks/01b-dataframes.html" rel="" target="">
 <span class="dropdown-text">Useful Python packages for different data types</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-3" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-3">    
        <li>
    <a class="dropdown-item" href="../notebooks/02b-Clustering.html" rel="" target="">
 <span class="dropdown-text">Numerical Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/03-ML_workflow.html" rel="" target="">
 <span class="dropdown-text">Machine Learning Workflow</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-4" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-4">    
        <li>
    <a class="dropdown-item" href="../notebooks/04a-SimpleSpeedUps.html" rel="" target="">
 <span class="dropdown-text">Efficient Python Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/02a-mapping.html" rel="" target="">
 <span class="dropdown-text">Bonus: Matplotlib and Mapping with Cartopy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/03b-DeepLearningTS.html" rel="" target="">
 <span class="dropdown-text">Bonus: Deep Learning &amp; Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/04b-DaskDataframes.html" rel="" target="">
 <span class="dropdown-text">Bonus: Dask data frames</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/merge.html" rel="" target="">
 <span class="dropdown-text">Bonus: Merging Text Tables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/PDF2Python.html" rel="" target="">
 <span class="dropdown-text">Bonus: Working with PDF files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/text2segy.html" rel="" target="">
 <span class="dropdown-text">Bonus: segy2text2segy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/hdfeos.html" rel="" target="">
 <span class="dropdown-text">Bonus: HDF-EOS</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#questions" id="toc-questions" class="nav-link active" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#building-a-dataset-of-targets-and-predictor-variables" id="toc-building-a-dataset-of-targets-and-predictor-variables" class="nav-link" data-scroll-target="#building-a-dataset-of-targets-and-predictor-variables">Building a dataset of “targets” and “predictor variables”</a>
  <ul class="collapse">
  <li><a href="#step-1---determine-our-target-variable" id="toc-step-1---determine-our-target-variable" class="nav-link" data-scroll-target="#step-1---determine-our-target-variable">Step 1 - Determine our target variable</a>
  <ul class="collapse">
  <li><a href="#deposit-locations---mine-and-mineral-occurrences" id="toc-deposit-locations---mine-and-mineral-occurrences" class="nav-link" data-scroll-target="#deposit-locations---mine-and-mineral-occurrences">Deposit locations - mine and mineral occurrences</a></li>
  </ul></li>
  <li><a href="#step-2---wrangle-the-geophysical-and-geological-datasets-predictor-variables" id="toc-step-2---wrangle-the-geophysical-and-geological-datasets-predictor-variables" class="nav-link" data-scroll-target="#step-2---wrangle-the-geophysical-and-geological-datasets-predictor-variables">Step 2 - Wrangle the geophysical and geological datasets (predictor variables)</a>
  <ul class="collapse">
  <li><a href="#resistivity-xyz-data" id="toc-resistivity-xyz-data" class="nav-link" data-scroll-target="#resistivity-xyz-data">Resistivity xyz data</a></li>
  <li><a href="#faults-and-dykes-vector-polylines" id="toc-faults-and-dykes-vector-polylines" class="nav-link" data-scroll-target="#faults-and-dykes-vector-polylines">Faults and dykes vector polylines</a></li>
  <li><a href="#netcdf-formatted-raster-grids---geophysics" id="toc-netcdf-formatted-raster-grids---geophysics" class="nav-link" data-scroll-target="#netcdf-formatted-raster-grids---geophysics">Netcdf formatted raster grids - geophysics</a></li>
  <li><a href="#categorical-geology-in-vector-polygons" id="toc-categorical-geology-in-vector-polygons" class="nav-link" data-scroll-target="#categorical-geology-in-vector-polygons">Categorical Geology in vector polygons</a></li>
  </ul></li>
  <li><a href="#step-3---assign-geophys-values-to-target-locations" id="toc-step-3---assign-geophys-values-to-target-locations" class="nav-link" data-scroll-target="#step-3---assign-geophys-values-to-target-locations">Step 3 - Assign geophys values to target locations</a>
  <ul class="collapse">
  <li><a href="#resistivity" id="toc-resistivity" class="nav-link" data-scroll-target="#resistivity">Resistivity</a></li>
  <li><a href="#faults" id="toc-faults" class="nav-link" data-scroll-target="#faults">Faults</a></li>
  <li><a href="#geophysics" id="toc-geophysics" class="nav-link" data-scroll-target="#geophysics">Geophysics</a></li>
  <li><a href="#geology" id="toc-geology" class="nav-link" data-scroll-target="#geology">Geology</a></li>
  </ul></li>
  <li><a href="#step-4---generate-a-non-deposit-dataset" id="toc-step-4---generate-a-non-deposit-dataset" class="nav-link" data-scroll-target="#step-4---generate-a-non-deposit-dataset">Step 4 - Generate a “non-deposit” dataset</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine Learning</a>
  <ul class="collapse">
  <li><a href="#ml-classification" id="toc-ml-classification" class="nav-link" data-scroll-target="#ml-classification">ML Classification</a></li>
  </ul></li>
  <li><a href="#find-where-to-dig" id="toc-find-where-to-dig" class="nav-link" data-scroll-target="#find-where-to-dig">Find where to dig!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine Learning (ML) From Scratch</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="questions" class="level3 questions">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<ul>
<li>How can I use Python for Machine learning?</li>
<li>How to I wrange my data to work within an ML context?</li>
<li>How do I assess whether my models fit well?</li>
</ul>
</section>
<section id="objectives" class="level3 objectives">
<h3 class="anchored" data-anchor-id="objectives">Objectives</h3>
<ul>
<li>Use scikit-learn to solve a machine learning problem</li>
</ul>
</section>
<p>Most machine learning problems begin with a dataset, but before we can perform any kind of inference on that dataset we must create/wrangle/build it. This is often the most time-consuming and hard part of a successful machine learning workflow. There is no set procedure here, as all data is different, although there are a few simple methods we can take to make a useful dataset.</p>
<p>Machine learning can be split into:</p>
<ul>
<li><p>Supervised learning, where we are trying to predict:</p>
<ul>
<li>A numeric value such as a stock price, mineral quantity at a specific site etc. This is called “regression”.</li>
<li>A categorical label, such as having/not having a specific disease, a response (such as “low”, “medium”, “high”) etc. This is called “classification”.</li>
</ul></li>
<li><p>Unsupervised learning, where we are trying to find groups in our data withouth specifying a particular outcome to split the dataset along.</p></li>
</ul>
<p>We will be using data from a submitted Manuscript (Butterworth and Barnett-Moore 2020) which was a finalist in the <a href="https://unearthed.solutions/u/competitions/exploresa">Unearthed, ExploreSA: Gawler Challenge</a>. You can visit the <a href="https://github.com/natbutter/gawler-exploration">original repo here</a>.</p>
<section id="building-a-dataset-of-targets-and-predictor-variables" class="level1">
<h1>Building a dataset of “targets” and “predictor variables”</h1>
<p>The targets in a supervised ML context can be a simple binary 1 or 0, or could be some category (classification), or the value of a particular parameter (regression problems). It is the “feature” of a dataset that we want to learn something about!</p>
<p>The “predictor/feature variables” are the qualities/parameters that may have some causal relationship with the “target”.</p>
<section id="step-1---determine-our-target-variable" class="level2">
<h2 class="anchored" data-anchor-id="step-1---determine-our-target-variable">Step 1 - Determine our target variable</h2>
<p>Let’s explore our our main dataset.</p>
<section id="deposit-locations---mine-and-mineral-occurrences" class="level3">
<h3 class="anchored" data-anchor-id="deposit-locations---mine-and-mineral-occurrences">Deposit locations - mine and mineral occurrences</h3>
<p>The most important dataset for this workflow is the currently known locations of mineral occurrences. Using the data we already know about these mineral deposits we will build a model to predict where future occurrences will be.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For working with shapefiles (packaged is called pyshp)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapefile</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For working with dataframes</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the filename</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mineshape<span class="op">=</span><span class="st">"../data/MinesMinerals/mines_and_mineral_occurrences_all.shp"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set shapefile attributes and assign</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> shapefile.Reader(mineshape)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> sf.fields][<span class="dv">1</span>:]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>records <span class="op">=</span> sf.records()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>shps <span class="op">=</span> [s.points <span class="cf">for</span> s <span class="kw">in</span> sf.shapes()]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Write into a dataframe for easy use</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>fields, data<span class="op">=</span>records)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View the metadata of the <a href="https://catalog.sarig.sa.gov.au/geonetwork/srv/eng/catalog.search#/metadata/a0e4b62c-ec88-44b8-a530-b4e744a6b414">South Australian all mines and mineral deposits</a> to get a better understanding for what features we could use as a target.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#See what the dataframe looks like</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#For clean printing to html drop columns that contains annoying / and \ chars.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#And set max columns</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'REFERENCE'</span>,<span class="st">'O_MAP_SYMB'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['MINDEP_NO', 'DEP_NAME', 'REFERENCE', 'COMM_CODE', 'COMMODS',
       'COMMOD_MAJ', 'COMM_SPECS', 'GCHEM_ASSC', 'DISC_YEAR', 'CLASS_CODE',
       'OPER_TYPE', 'MAP_SYMB', 'STATUS_VAL', 'SIZE_VAL', 'GEOL_PROV',
       'DB_RES_RVE', 'DB_PROD', 'DB_DOC_IMG', 'DB_EXV_IMG', 'DB_DEP_IMG',
       'DB_DEP_FLE', 'COX_CLASS', 'REG_O_CTRL', 'LOC_O_CTRL', 'LOC_O_COM',
       'O_LITH_CDE', 'O_LITH01', 'O_STRAT_NM', 'H_LITH_CDE', 'H_LITH02',
       'H_STRAT_NM', 'H_MAP_SYMB', 'EASTING', 'NORTHING', 'ZONE', 'LONGITUDE',
       'LATITUDE', 'SVY_METHOD', 'HORZ_ACC', 'SRCE_MAP', 'SRCE_CNTRE',
       'COMMENTS', 'O_MAP_SYMB'],
      dtype='object')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MINDEP_NO</th>
<th data-quarto-table-cell-role="th">DEP_NAME</th>
<th data-quarto-table-cell-role="th">COMM_CODE</th>
<th data-quarto-table-cell-role="th">COMMODS</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">HORZ_ACC</th>
<th data-quarto-table-cell-role="th">SRCE_MAP</th>
<th data-quarto-table-cell-role="th">SRCE_CNTRE</th>
<th data-quarto-table-cell-role="th">COMMENTS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5219</td>
<td>MOUNT DAVIES NO.2A</td>
<td>Ni</td>
<td>Nickel</td>
<td>...</td>
<td>2000.0</td>
<td>500k meis</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>52</td>
<td>ONE STONE</td>
<td>Ni</td>
<td>Nickel</td>
<td>...</td>
<td>500.0</td>
<td>71-385</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8314</td>
<td>HINCKLEY RANGE</td>
<td>Fe</td>
<td>Iron</td>
<td>...</td>
<td>500.0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>69</td>
<td>KALKA</td>
<td>V, ILM</td>
<td>Vanadium, Ilmenite</td>
<td>...</td>
<td>100.0</td>
<td>1 MILE</td>
<td>mgt polygon on digital map</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>65</td>
<td>ECHIDNA</td>
<td>Ni</td>
<td>Nickel</td>
<td>...</td>
<td>20.0</td>
<td>50K GEOL</td>
<td>DH ECHIDNA PROSPECT</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8672</td>
<td>6937</td>
<td>YARINGA</td>
<td>QTZE</td>
<td>Quartzite</td>
<td>...</td>
<td>200.0</td>
<td>50k moc</td>
<td>fenced yard</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8673</td>
<td>4729</td>
<td>WELCHS</td>
<td>SCHT</td>
<td>Schist</td>
<td>...</td>
<td>20.0</td>
<td>50k topo</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8674</td>
<td>4718</td>
<td>ARCADIAN</td>
<td>CLAY</td>
<td>Clay</td>
<td>...</td>
<td>5.0</td>
<td>Plan 1951-0327</td>
<td>Pit</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8675</td>
<td>1436</td>
<td>MCDONALD</td>
<td>Au</td>
<td>Gold</td>
<td>...</td>
<td>200.0</td>
<td>50k moc</td>
<td>qz float</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8676</td>
<td>8934</td>
<td>FAIRFIELD FARM</td>
<td>SAND</td>
<td>Sand</td>
<td>...</td>
<td>20.0</td>
<td></td>
<td>pit</td>
<td></td>
</tr>
</tbody>
</table>

<p>8677 rows × 41 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We are building a model to target South Australia, so load in a map of it.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>gawlshape<span class="op">=</span><span class="st">"../data/SA/SA_STATE_POLYGON_shp"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>shapeRead <span class="op">=</span> shapefile.Reader(gawlshape)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>shapes  <span class="op">=</span> shapeRead.shapes()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Save the boundary xy pairs in arrays we will use throughout the workflow</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>xval <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> shapes[<span class="dv">1</span>].points]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>yval <span class="op">=</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> shapes[<span class="dv">1</span>].points]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data, for a single Mineral target</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>commname<span class="op">=</span><span class="st">'Mn'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Pull out all the occurences of the commodity and go from there</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>comm<span class="op">=</span>df[df[<span class="st">'COMM_CODE'</span>].<span class="bu">str</span>.contains(commname)]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>comm<span class="op">=</span>comm.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Shape of "</span><span class="op">+</span> commname, comm.shape)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Can make further subsets of the data here if needed</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#commsig=comm[comm.SIZE_VAL!="Low Significance"]</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#comm=comm[comm.SIZE_VAL!="Low Significance"]</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#comm=comm[comm.COX_CLASS == "Olympic Dam Cu-U-Au"]</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#comm=comm[(comm.lon&lt;max(xval)) &amp; (comm.lon&gt;min(xval)) &amp; (comm.lat&gt;min(yval)) &amp; (comm.lat&lt;max(yval))]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape of Mn (115, 43)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For plotting</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ax.plot(df.LONGITUDE,df.LATITUDE,<span class="st">'b.'</span>,label<span class="op">=</span><span class="st">"All Mineral Deposits"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ax.plot(comm.LONGITUDE,comm.LATITUDE,<span class="st">'yx'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.plot(comm.LONGITUDE, comm.LATITUDE, marker='o', linestyle='',markersize=5, color='y',label=commname+" Deposits")</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="step-2---wrangle-the-geophysical-and-geological-datasets-predictor-variables" class="level2">
<h2 class="anchored" data-anchor-id="step-2---wrangle-the-geophysical-and-geological-datasets-predictor-variables">Step 2 - Wrangle the geophysical and geological datasets (predictor variables)</h2>
<p>Many geophysical data are available for South Australia overlapping our target mineral locations. We may presume that certain mineral occurrences express a combination of geology and geophysics. We can train an algorithm to learn these associations and then use the same algorithm to make predictions for where unknown occurrences may be found.</p>
<p>Here we load in the (slightly) pre-processed geophysical datasets and prepare them for further manipulations, data-mining, and machine learning. All of the full/raw datasets are available from https://map.sarig.sa.gov.au/. For this exercise we have simplified the datasets by reducing complexity and resolution. Grab additional processed datasets from <a href="https://github.com/natbutter/gawler-exploration/tree/master/ML-DATA">https://github.com/natbutter/gawler-exploration/tree/master/ML-DATA</a></p>
<section id="resistivity-xyz-data" class="level3">
<h3 class="anchored" data-anchor-id="resistivity-xyz-data">Resistivity xyz data</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data_res<span class="op">=</span>pd.read_csv(<span class="st">"../data/AusLAMP_MT_Gawler_25.xyzr"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                     sep<span class="op">=</span><span class="st">','</span>,header<span class="op">=</span><span class="dv">0</span>,names<span class="op">=</span>[<span class="st">'lat'</span>,<span class="st">'lon'</span>,<span class="st">'depth'</span>,<span class="st">'resistivity'</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>data_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">depth</th>
<th data-quarto-table-cell-role="th">resistivity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-27.363931</td>
<td>128.680796</td>
<td>-25.0</td>
<td>2.0007</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-27.659362</td>
<td>128.662322</td>
<td>-25.0</td>
<td>1.9979</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-27.886602</td>
<td>128.647965</td>
<td>-25.0</td>
<td>1.9948</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-28.061394</td>
<td>128.636833</td>
<td>-25.0</td>
<td>1.9918</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-28.195844</td>
<td>128.628217</td>
<td>-25.0</td>
<td>1.9885</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11003</td>
<td>-35.127716</td>
<td>142.399588</td>
<td>-25.0</td>
<td>2.0079</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11004</td>
<td>-35.230939</td>
<td>142.408396</td>
<td>-25.0</td>
<td>2.0084</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11005</td>
<td>-35.365124</td>
<td>142.419903</td>
<td>-25.0</td>
<td>2.0085</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11006</td>
<td>-35.539556</td>
<td>142.434958</td>
<td>-25.0</td>
<td>2.0076</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11007</td>
<td>-35.766303</td>
<td>142.454694</td>
<td>-25.0</td>
<td>2.0049</td>
</tr>
</tbody>
</table>

<p>11008 rows × 4 columns</p>
</div>
</div>
</div>
<p>This data is the Lat-Lon spatial location and the value of the feature at that location.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>im<span class="op">=</span>ax.scatter(data_res.lon,data_res.lat,s<span class="op">=</span><span class="dv">4</span>,c<span class="op">=</span>data_res.resistivity,cmap<span class="op">=</span><span class="st">"jet"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ax.plot(comm.LONGITUDE, comm.LATITUDE, marker<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'y'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>cbaxes <span class="op">=</span> fig.add_axes([<span class="fl">0.40</span>, <span class="fl">0.18</span>, <span class="fl">0.2</span>, <span class="fl">0.015</span>])</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im, cax <span class="op">=</span> cbaxes,orientation<span class="op">=</span><span class="st">"horizontal"</span>,extend<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Resistivity $\Omega$.m'</span>, labelpad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="faults-and-dykes-vector-polylines" class="level3">
<h3 class="anchored" data-anchor-id="faults-and-dykes-vector-polylines">Faults and dykes vector polylines</h3>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For dealing with arrays </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get fault data neo</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>faultshape<span class="op">=</span><span class="st">"../data/Faults/Faults.shp"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>shapeRead <span class="op">=</span> shapefile.Reader(faultshape)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>shapes  <span class="op">=</span> shapeRead.shapes()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>Nshp    <span class="op">=</span> <span class="bu">len</span>(shapes)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>faultsNeo<span class="op">=</span>[]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,Nshp):</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> shapes[i].points:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        faultsNeo.append([j[<span class="dv">0</span>],j[<span class="dv">1</span>]])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>faultsNeo<span class="op">=</span>np.array(faultsNeo)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>faultsNeo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>array([[133.46269605, -27.41825034],
       [133.46770683, -27.42062991],
       [133.4723624 , -27.42259841],
       ...,
       [138.44613353, -35.36560605],
       [138.44160669, -35.36672662],
       [138.43805501, -35.36793484]])</code></pre>
</div>
</div>
<p>This data is just a Lat-Lon location. Think how we can use this in a model.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.plot(faultsNeo[:,<span class="dv">0</span>],faultsNeo[:,<span class="dv">1</span>],<span class="st">'.'</span>,markersize<span class="op">=</span><span class="fl">0.1</span>,label<span class="op">=</span><span class="st">"Neoproterozoic-Faults"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>ax.plot(comm.LONGITUDE, comm.LATITUDE, marker<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'y'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="netcdf-formatted-raster-grids---geophysics" class="level3">
<h3 class="anchored" data-anchor-id="netcdf-formatted-raster-grids---geophysics">Netcdf formatted raster grids - geophysics</h3>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For timing events</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For making grids and reading netcdf data</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.io</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define a function to read the netcdf files</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> readnc(filename):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    tic<span class="op">=</span>time.time()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    rasterfile<span class="op">=</span>filename</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> scipy.io.netcdf_file(rasterfile,<span class="st">'r'</span>,mmap<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    xdata<span class="op">=</span>data.variables[<span class="st">'lon'</span>][:]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ydata<span class="op">=</span>data.variables[<span class="st">'lat'</span>][:]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    zdata<span class="op">=</span>np.array(data.variables[<span class="st">'Band1'</span>][:])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    data.close()</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    toc<span class="op">=</span>time.time()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Loaded"</span>, rasterfile, <span class="st">"in"</span>, <span class="ss">f'</span><span class="sc">{</span>toc<span class="op">-</span>tic<span class="sc">:.2f}</span><span class="ss">s'</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Spacing x"</span>, <span class="ss">f'</span><span class="sc">{</span>xdata[<span class="dv">2</span>]<span class="op">-</span>xdata[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"y"</span>, <span class="ss">f'</span><span class="sc">{</span>ydata[<span class="dv">2</span>]<span class="op">-</span>ydata[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">'</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Shape:"</span>, np.shape(zdata), <span class="st">"Min x:"</span>, np.<span class="bu">min</span>(xdata), <span class="st">"Max x:"</span>, np.<span class="bu">max</span>(xdata),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Min y:"</span>, np.<span class="bu">min</span>(ydata), <span class="ss">f'Max y </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(ydata)<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(xdata,ydata,zdata,np.<span class="bu">min</span>(xdata),np.<span class="bu">min</span>(ydata),xdata[<span class="dv">2</span>]<span class="op">-</span>xdata[<span class="dv">1</span>],ydata[<span class="dv">2</span>]<span class="op">-</span>ydata[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Digital Elevation Model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>x1,y1,z1,originx1,originy1,pixelx1,pixely1 <span class="op">=</span> readnc(<span class="st">"../data/sa-dem.nc"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Total Magnetic Intensity</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>x2,y2,z2,originx2,originy2,pixelx2,pixely2 <span class="op">=</span> readnc(<span class="st">"../data/sa-mag-tmi.nc"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Gravity</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>x3,y3,z3,originx3,originy3,pixelx3,pixely3 <span class="op">=</span> readnc(<span class="st">"../data/sa-grav.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded ../data/sa-dem.nc in 0.00s
Spacing x 0.01 y 0.01 Shape: (1208, 1201) Min x: 129.005 Max x: 141.005 Min y: -38.065 Max y -25.99
Loaded ../data/sa-mag-tmi.nc in 0.00s
Spacing x 0.01 y 0.01 Shape: (1208, 1201) Min x: 129.005 Max x: 141.005 Min y: -38.065 Max y -25.99
Loaded ../data/sa-grav.nc in 0.00s
Spacing x 0.01 y 0.01 Shape: (1208, 1201) Min x: 129.005 Max x: 141.005 Min y: -38.065 Max y -25.99</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>im<span class="op">=</span>plt.pcolormesh(x1,y1,z1,cmap<span class="op">=</span><span class="st">'Greys'</span>,shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax.plot(comm.LONGITUDE, comm.LATITUDE, marker<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'y'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>cbaxes <span class="op">=</span> fig.add_axes([<span class="fl">0.40</span>, <span class="fl">0.18</span>, <span class="fl">0.2</span>, <span class="fl">0.015</span>])</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im, cax <span class="op">=</span> cbaxes,orientation<span class="op">=</span><span class="st">"horizontal"</span>,extend<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'DEM (m)'</span>, labelpad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>cbar.ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These data are raster grids. Essentially Lat-Lon-Value like the XYZ data, but represented in a different format.</p>
</section>
<section id="categorical-geology-in-vector-polygons" class="level3">
<h3 class="anchored" data-anchor-id="categorical-geology-in-vector-polygons">Categorical Geology in vector polygons</h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Archean basement geology</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>geolshape<span class="op">=</span>shapefile.Reader(<span class="st">"../data/Archaean_Early_Mesoprterzoic_polygons_shp/geology_archaean.shp"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>recsArch   <span class="op">=</span> geolshape.records()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>shapesArch  <span class="op">=</span> geolshape.shapes()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the field names in the shapefile</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,field <span class="kw">in</span> <span class="bu">enumerate</span>(geolshape.fields):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i<span class="op">-</span><span class="dv">1</span>,field[<span class="dv">0</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-1 DeletionFlag
0 MAJORSTRAT
1 SG_DESCRIP
2 MAPUNIT
3 SG_PROVINC
4 DOMAIN
5 AGE
6 SEQUSET
7 PRIMARYAGE
8 OROGENYAGE
9 INHERITAGE
10 STRATNO
11 STRATNAME
12 STRATDESC
13 GISCODE
14 SUBDIVNAME
15 SUBDIVSYMB
16 PROVINCE
17 MAXAGE
18 MAXMOD
19 MAXMETH
20 MINAGE
21 MINMOD
22 MINMETH
23 GLCODE</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#index of the geology unit #4 #10 #12</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>geoindex <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Gather all the unique Major Geology unit numbers</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>labs<span class="op">=</span>[]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> recsArch:</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    labs.append(i[geoindex])</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>geols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(labs))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique color for each geological unit label</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> plt.cm.tab20(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(geols)))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>cdict<span class="op">=</span>{}</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, geol <span class="kw">in</span> <span class="bu">enumerate</span>(geols):</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    cdict.update({geol:color[i]})</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot each of the geology polygons</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>legend1<span class="op">=</span>[]</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(shapesArch)):</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    boundary <span class="op">=</span> shapesArch[i].points</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> [x <span class="cf">for</span> x, y <span class="kw">in</span> shapesArch[i].points]</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> [y <span class="cf">for</span> x, y <span class="kw">in</span> shapesArch[i].points]</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> cdict[recsArch[i][geoindex]]</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    l1 <span class="op">=</span> ax.fill(xs,ys,c<span class="op">=</span>c,label<span class="op">=</span>recsArch[i][geoindex])</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    legend1.append(l1)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the extra stuff</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>l3 <span class="op">=</span> ax.plot(comm.LONGITUDE, comm.LATITUDE, </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'s'</span>, markeredgecolor<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">'y'</span>,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo: Split the legends</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.legend([l2,l3],['SA',commname+" Deposits"],loc=3)</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Legend without duplicate values</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>unique <span class="op">=</span> [(h, l) <span class="cf">for</span> i, (h, l) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(handles, labels)) <span class="cf">if</span> l <span class="kw">not</span> <span class="kw">in</span> labels[:i]]</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>ax.legend(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>unique), bbox_to_anchor <span class="op">=</span> (<span class="fl">1.02</span>, <span class="fl">1.01</span>), ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.legend(loc=3) #bbox_to_anchor = (1.05, 0.6))</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Take a moment to appreciate the various methods you have used just to load the data!</strong></p>
<p>Now we need to think about what we actually want to achieve? What is our goal here? This will determine what kind of data analysis/manipulation we need to make here. Consider the flow diagram for <a href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">choosing the right machine learning method</a>.</p>
</section>
</section>
<section id="step-3---assign-geophys-values-to-target-locations" class="level2">
<h2 class="anchored" data-anchor-id="step-3---assign-geophys-values-to-target-locations">Step 3 - Assign geophys values to target locations</h2>
<p>We need to assign the values of each of these geophysical datasets (predictor variables) to the target class (i.e.&nbsp;mineral deposit locations). The assumption being that the occurrence of some mineral deposit (e.g.&nbsp;Cu) is a function of x1, x2, x3, x4, x5, x6. Where the Resistivity is x1, the distance to a Neoprotezoic fault is x2, the value of DEM, magnetic TMI, and Gravity is x3, x4, and x5, and the geological basement unit is x6.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a Target DataFrame of the points we want to interrogate the features for</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>td1 <span class="op">=</span> comm[[<span class="st">'LONGITUDE'</span>, <span class="st">'LATITUDE'</span>]].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="resistivity" class="level3">
<h3 class="anchored" data-anchor-id="resistivity">Resistivity</h3>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For making KD Trees</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.spatial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function which "coregisters" a point from a bunch of other points.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> coregPoint(tree,point,region,retval<span class="op">=</span><span class="st">'index'</span>):</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds the nearest neighbour to a point from a bunch of other points</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    tree - a scipy CKTree to search for the point over</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    point - array([longitude,latitude])</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    region - integer, same units as data</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    dists, indexes <span class="op">=</span> tree.query(point,k<span class="op">=</span><span class="dv">1</span>,distance_upper_bound<span class="op">=</span>region) </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> retval<span class="op">==</span><span class="st">'index'</span>:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (indexes)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> retval<span class="op">==</span><span class="st">'dists'</span>:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(dists)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the values of the resetivity grid for each lat/lon deposit location.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a search-tree of the point-pairs for fast lookup of nearest matches</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>treeres <span class="op">=</span> scipy.spatial.cKDTree(np.c_[data_res.lon,data_res.lat])</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the search for each point</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>indexes <span class="op">=</span> td1.<span class="bu">apply</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treeres,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">1</span>,retval<span class="op">=</span><span class="st">'index'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'res'</span>] <span class="op">=</span> data_res.loc[indexes].resistivity.values</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>td1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LONGITUDE</th>
<th data-quarto-table-cell-role="th">LATITUDE</th>
<th data-quarto-table-cell-role="th">res</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>139.179436</td>
<td>-29.877637</td>
<td>2.2135</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>138.808767</td>
<td>-30.086296</td>
<td>2.3643</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138.752281</td>
<td>-30.445684</td>
<td>2.1141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>138.530506</td>
<td>-30.533225</td>
<td>2.2234</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>138.887019</td>
<td>-30.565479</td>
<td>2.1982</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>136.059715</td>
<td>-34.327929</td>
<td>3.4926</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">111</td>
<td>138.016821</td>
<td>-35.733084</td>
<td>2.0868</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>139.250036</td>
<td>-34.250155</td>
<td>1.9811</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>135.905480</td>
<td>-34.425866</td>
<td>2.7108</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>135.835578</td>
<td>-34.509779</td>
<td>3.1224</td>
</tr>
</tbody>
</table>

<p>115 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="faults" class="level3">
<h3 class="anchored" data-anchor-id="faults">Faults</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Same for the fault data </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># but this time we get the "distance to the point", rather than the value at that point.</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>treefaults <span class="op">=</span> scipy.spatial.cKDTree(faultsNeo)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> td1.<span class="bu">apply</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treefaults,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">100</span>,retval<span class="op">=</span><span class="st">'dists'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'faults'</span>] <span class="op">=</span> dists</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>td1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LONGITUDE</th>
<th data-quarto-table-cell-role="th">LATITUDE</th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">faults</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>139.179436</td>
<td>-29.877637</td>
<td>2.2135</td>
<td>0.010691</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>138.808767</td>
<td>-30.086296</td>
<td>2.3643</td>
<td>0.103741</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138.752281</td>
<td>-30.445684</td>
<td>2.1141</td>
<td>0.006659</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>138.530506</td>
<td>-30.533225</td>
<td>2.2234</td>
<td>0.013925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>138.887019</td>
<td>-30.565479</td>
<td>2.1982</td>
<td>0.007356</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>136.059715</td>
<td>-34.327929</td>
<td>3.4926</td>
<td>0.526835</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">111</td>
<td>138.016821</td>
<td>-35.733084</td>
<td>2.0868</td>
<td>0.002451</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>139.250036</td>
<td>-34.250155</td>
<td>1.9811</td>
<td>0.027837</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>135.905480</td>
<td>-34.425866</td>
<td>2.7108</td>
<td>0.670323</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>135.835578</td>
<td>-34.509779</td>
<td>3.1224</td>
<td>0.776152</td>
</tr>
</tbody>
</table>

<p>115 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="geophysics" class="level3">
<h3 class="anchored" data-anchor-id="geophysics">Geophysics</h3>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function which "coregisters" a point within a raster.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_coords_at_point(originx,originy,pixelx,pixely,lon,lat):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Given a point in some coordinate reference (e.g. lat/lon)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Find the closest point to that in an array (e.g. a raster)</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and return the index location of that point in the raster.</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">    INPUTS</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">        "output from "gdal_data.GetGeoTransform()"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">    originx: first point in first axis</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">    originy: first point in second axis</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">    pixelx: difference between x points</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">    pixely: difference between y points</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">    lon: x/row-coordinate of interest</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">    lat: y/column-coordinate of interest</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">    RETURNS</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">    col: x index value from the raster</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">    row: y index value from the raster</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> <span class="bu">int</span>((lon <span class="op">-</span> originx)<span class="op">/</span>pixelx)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> <span class="bu">int</span>((lat <span class="op">-</span> originy)<span class="op">/</span>pixely)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (col, row)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Pass entire array of latlon and raster info to us in get_coords_at_point</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rastersearch(latlon,raster,originx,originy,pixelx,pixely):</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    zlist<span class="op">=</span>[]</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lon,lat <span class="kw">in</span> <span class="bu">zip</span>(latlon.LONGITUDE,latlon.LATITUDE):</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>            zlist.append(raster[get_coords_at_point(originx,originy,pixelx,pixely,lon,lat)])</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>            zlist.append(np.nan)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(zlist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'dem'</span>] <span class="op">=</span> rastersearch(td1,z1,originx1,originy1,pixelx1,pixely1)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'mag'</span>] <span class="op">=</span> rastersearch(td1,z2,originx2,originy2,pixelx2,pixely2)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'grav'</span>] <span class="op">=</span> rastersearch(td1,z3,originx3,originy3,pixelx3,pixely3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>td1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LONGITUDE</th>
<th data-quarto-table-cell-role="th">LATITUDE</th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">faults</th>
<th data-quarto-table-cell-role="th">dem</th>
<th data-quarto-table-cell-role="th">mag</th>
<th data-quarto-table-cell-role="th">grav</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>139.179436</td>
<td>-29.877637</td>
<td>2.2135</td>
<td>0.010691</td>
<td>187.297424</td>
<td>-118.074890</td>
<td>1.852599</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>138.808767</td>
<td>-30.086296</td>
<td>2.3643</td>
<td>0.103741</td>
<td>179.499237</td>
<td>-209.410507</td>
<td>-12.722121</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138.752281</td>
<td>-30.445684</td>
<td>2.1141</td>
<td>0.006659</td>
<td>398.336823</td>
<td>-159.566422</td>
<td>-6.249788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>138.530506</td>
<td>-30.533225</td>
<td>2.2234</td>
<td>0.013925</td>
<td>335.983429</td>
<td>-131.176437</td>
<td>-11.665316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>138.887019</td>
<td>-30.565479</td>
<td>2.1982</td>
<td>0.007356</td>
<td>554.278198</td>
<td>-192.363297</td>
<td>-1.025702</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>136.059715</td>
<td>-34.327929</td>
<td>3.4926</td>
<td>0.526835</td>
<td>45.866119</td>
<td>-244.067841</td>
<td>11.410070</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">111</td>
<td>138.016821</td>
<td>-35.733084</td>
<td>2.0868</td>
<td>0.002451</td>
<td>145.452789</td>
<td>-203.566940</td>
<td>18.458364</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>139.250036</td>
<td>-34.250155</td>
<td>1.9811</td>
<td>0.027837</td>
<td>276.489319</td>
<td>-172.889587</td>
<td>-1.714886</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>135.905480</td>
<td>-34.425866</td>
<td>2.7108</td>
<td>0.670323</td>
<td>162.431747</td>
<td>569.713684</td>
<td>15.066316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>135.835578</td>
<td>-34.509779</td>
<td>3.1224</td>
<td>0.776152</td>
<td>89.274399</td>
<td>64.385925</td>
<td>24.267015</td>
</tr>
</tbody>
</table>

<p>115 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check we got it right.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a grid, and our interrogated points</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>im<span class="op">=</span>plt.pcolormesh(x3,y3,z3,cmap<span class="op">=</span><span class="st">'jet'</span>,shading<span class="op">=</span><span class="st">'auto'</span>,vmin<span class="op">=</span><span class="bu">min</span>(td1.grav),vmax<span class="op">=</span><span class="bu">max</span>(td1.grav))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.plot(xval,yval,'grey',linestyle='--',linewidth=1,label='SA')</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.plot(comm.LONGITUDE, comm.LATITUDE, marker='o', linestyle='',markersize=5, color='y',label=commname+" Deposits")</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>ax.scatter(td1.LONGITUDE, td1.LATITUDE, s<span class="op">=</span><span class="dv">20</span>, c<span class="op">=</span>td1.grav,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Gravity"</span>,cmap<span class="op">=</span><span class="st">'jet'</span>,vmin<span class="op">=</span><span class="bu">min</span>(td1.grav),vmax<span class="op">=</span><span class="bu">max</span>(td1.grav),edgecolors<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">138</span>,<span class="dv">140</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">32</span>,<span class="op">-</span><span class="dv">30</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>cbaxes <span class="op">=</span> fig.add_axes([<span class="fl">0.40</span>, <span class="fl">0.18</span>, <span class="fl">0.2</span>, <span class="fl">0.015</span>])</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im, cax <span class="op">=</span> cbaxes,orientation<span class="op">=</span><span class="st">"horizontal"</span>,extend<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Gravity (gal)'</span>, labelpad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>cbar.ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="geology" class="level3">
<h3 class="anchored" data-anchor-id="geology">Geology</h3>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For dealing with shapefile components</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> shape</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Define a function to find what polygon a point lives inside (speed imporivements can be made here)</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shapeExplore(lon,lat,shapes,recs,record):</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#'record' is the column index you want returned</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(shapes)):</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        boundary <span class="op">=</span> shapes[i]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Point((lon,lat)).within(shape(boundary)):</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span>(recs[i][record])</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#if you have been through the loop with no result</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="st">'-9999'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>geoindex <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'geol'</span>]<span class="op">=</span>td1.<span class="bu">apply</span>(<span class="kw">lambda</span> x: shapeExplore(x.LONGITUDE, x.LATITUDE, shapesArch,recsArch,geoindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 4.57 s, sys: 75.1 ms, total: 4.65 s
Wall time: 4.52 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>td1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LONGITUDE</th>
<th data-quarto-table-cell-role="th">LATITUDE</th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">faults</th>
<th data-quarto-table-cell-role="th">dem</th>
<th data-quarto-table-cell-role="th">mag</th>
<th data-quarto-table-cell-role="th">grav</th>
<th data-quarto-table-cell-role="th">geol</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>139.179436</td>
<td>-29.877637</td>
<td>2.2135</td>
<td>0.010691</td>
<td>187.297424</td>
<td>-118.074890</td>
<td>1.852599</td>
<td>Crustal element Muloorina</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>138.808767</td>
<td>-30.086296</td>
<td>2.3643</td>
<td>0.103741</td>
<td>179.499237</td>
<td>-209.410507</td>
<td>-12.722121</td>
<td>Crustal element Adelaide</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138.752281</td>
<td>-30.445684</td>
<td>2.1141</td>
<td>0.006659</td>
<td>398.336823</td>
<td>-159.566422</td>
<td>-6.249788</td>
<td>Crustal element Adelaide</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>138.530506</td>
<td>-30.533225</td>
<td>2.2234</td>
<td>0.013925</td>
<td>335.983429</td>
<td>-131.176437</td>
<td>-11.665316</td>
<td>Crustal element Adelaide</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>138.887019</td>
<td>-30.565479</td>
<td>2.1982</td>
<td>0.007356</td>
<td>554.278198</td>
<td>-192.363297</td>
<td>-1.025702</td>
<td>Crustal element Adelaide</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>136.059715</td>
<td>-34.327929</td>
<td>3.4926</td>
<td>0.526835</td>
<td>45.866119</td>
<td>-244.067841</td>
<td>11.410070</td>
<td>Cleve, Spencer, Olympic Domains</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">111</td>
<td>138.016821</td>
<td>-35.733084</td>
<td>2.0868</td>
<td>0.002451</td>
<td>145.452789</td>
<td>-203.566940</td>
<td>18.458364</td>
<td>Crustal element Kanmantoo SW</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">112</td>
<td>139.250036</td>
<td>-34.250155</td>
<td>1.9811</td>
<td>0.027837</td>
<td>276.489319</td>
<td>-172.889587</td>
<td>-1.714886</td>
<td>Crustal element Kanmantoo Main</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>135.905480</td>
<td>-34.425866</td>
<td>2.7108</td>
<td>0.670323</td>
<td>162.431747</td>
<td>569.713684</td>
<td>15.066316</td>
<td>Cleve Domain</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>135.835578</td>
<td>-34.509779</td>
<td>3.1224</td>
<td>0.776152</td>
<td>89.274399</td>
<td>64.385925</td>
<td>24.267015</td>
<td>Cleve Domain</td>
</tr>
</tbody>
</table>

<p>115 rows × 8 columns</p>
</div>
</div>
</div>
<p><strong>Congrats, you now have an ML dataset ready to go!</strong></p>
<p>Almost… but what is the target? Let’s make a binary classifier.</p>
</section>
</section>
<section id="step-4---generate-a-non-deposit-dataset" class="level2">
<h2 class="anchored" data-anchor-id="step-4---generate-a-non-deposit-dataset">Step 4 - Generate a “non-deposit” dataset</h2>
<p>We have a set of locations where a certain mineral deposit occurs along with the values of various geophysical parameters at those locations. To identify what values of the geophysics are associated with a mineral deposit then we need a representation of the “background noise” of those parameters, i.e.&nbsp;what the values are when there is no mineral deposit.</p>
<p>This step is important. There are numerous ways to generate our non-deposit set, each with different benefits and trade-offs. The randomisation of points throughout <em>some</em> domain appears to be robust. But you must think, is this domain a reasonable estimation of “background” geophysics/geology? Why are you picking these locations as non-deposits? Will they be over/under-representing actual deposits? Will they be over/under-representing actual non-deposits?</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now make a set of "non-deposits" using a random location within our exploration area</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>lats_rand<span class="op">=</span>np.random.uniform(low<span class="op">=</span><span class="bu">min</span>(df.LATITUDE), high<span class="op">=</span><span class="bu">max</span>(df.LATITUDE), size<span class="op">=</span><span class="bu">len</span>(comm.LATITUDE))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>lons_rand<span class="op">=</span>np.random.uniform(low<span class="op">=</span><span class="bu">min</span>(df.LONGITUDE), high<span class="op">=</span><span class="bu">max</span>(df.LONGITUDE), size<span class="op">=</span><span class="bu">len</span>(comm.LONGITUDE))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Produced"</span>, <span class="bu">len</span>(lats_rand),<span class="bu">len</span>(lons_rand), <span class="st">"latitude-longitude pairs for non-deposits."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Produced 115 115 latitude-longitude pairs for non-deposits.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where are these randomised "non deposits"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>ax.plot(lons_rand, lats_rand, </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'.'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'b'</span>,label<span class="op">=</span><span class="st">"Random Samples"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ax.plot(td1.LONGITUDE, td1.LATITUDE, </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'y'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We must do the same coregistration/interrogation of the different data layers for our randomised “non-deposit” data.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>td2 <span class="op">=</span> pd.DataFrame({<span class="st">'LONGITUDE'</span>: lons_rand, <span class="st">'LATITUDE'</span>: lats_rand})</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Res</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>indexes <span class="op">=</span> td2.<span class="bu">apply</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treeres,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">10</span>,retval<span class="op">=</span><span class="st">'index'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'res'</span>] <span class="op">=</span> data_res.loc[indexes].resistivity.values</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Faults</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'faults'</span>] <span class="op">=</span> td2.<span class="bu">apply</span>(</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treefaults,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">100</span>,retval<span class="op">=</span><span class="st">'dists'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Geophys</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'dem'</span>] <span class="op">=</span> rastersearch(td2,z1,originx1,originy1,pixelx1,pixely1)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'mag'</span>] <span class="op">=</span> rastersearch(td2,z2,originx2,originy2,pixelx2,pixely2)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'grav'</span>] <span class="op">=</span> rastersearch(td2,z3,originx3,originy3,pixelx3,pixely3)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Geology</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'geol'</span>]<span class="op">=</span>td2.<span class="bu">apply</span>(<span class="kw">lambda</span> x: shapeExplore(x.LONGITUDE, x.LATITUDE, shapesArch,recsArch,geoindex), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 10.5 s, sys: 122 ms, total: 10.6 s
Wall time: 10.4 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add flag indicating classification label</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>td1[<span class="st">'deposit'</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>td2[<span class="st">'deposit'</span>]<span class="op">=</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fv <span class="op">=</span> pd.concat([td1,td2],axis<span class="op">=</span><span class="dv">0</span>,ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>fv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LONGITUDE</th>
<th data-quarto-table-cell-role="th">LATITUDE</th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">faults</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">mag</th>
<th data-quarto-table-cell-role="th">grav</th>
<th data-quarto-table-cell-role="th">geol</th>
<th data-quarto-table-cell-role="th">deposit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>139.179436</td>
<td>-29.877637</td>
<td>2.2135</td>
<td>0.010691</td>
<td>...</td>
<td>-118.074890</td>
<td>1.852599</td>
<td>Crustal element Muloorina</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>138.808767</td>
<td>-30.086296</td>
<td>2.3643</td>
<td>0.103741</td>
<td>...</td>
<td>-209.410507</td>
<td>-12.722121</td>
<td>Crustal element Adelaide</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138.752281</td>
<td>-30.445684</td>
<td>2.1141</td>
<td>0.006659</td>
<td>...</td>
<td>-159.566422</td>
<td>-6.249788</td>
<td>Crustal element Adelaide</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>138.530506</td>
<td>-30.533225</td>
<td>2.2234</td>
<td>0.013925</td>
<td>...</td>
<td>-131.176437</td>
<td>-11.665316</td>
<td>Crustal element Adelaide</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>138.887019</td>
<td>-30.565479</td>
<td>2.1982</td>
<td>0.007356</td>
<td>...</td>
<td>-192.363297</td>
<td>-1.025702</td>
<td>Crustal element Adelaide</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">225</td>
<td>140.264586</td>
<td>-36.024709</td>
<td>1.9738</td>
<td>0.109419</td>
<td>...</td>
<td>82.679138</td>
<td>3.195437</td>
<td>Crustal element Kanmantoo Main</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">226</td>
<td>132.210526</td>
<td>-26.808665</td>
<td>2.0358</td>
<td>0.445198</td>
<td>...</td>
<td>-311.140411</td>
<td>-32.652912</td>
<td>Fregon Subdomain</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">227</td>
<td>137.838001</td>
<td>-33.729123</td>
<td>-0.6225</td>
<td>0.333648</td>
<td>...</td>
<td>1048.547852</td>
<td>-20.456957</td>
<td>Nawa, Mount Woods, Fowler, Wilgena, Harris Gr</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">228</td>
<td>140.016574</td>
<td>-32.481088</td>
<td>2.0752</td>
<td>0.234001</td>
<td>...</td>
<td>-259.214233</td>
<td>-16.506145</td>
<td>Crustal element Adelaide</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">229</td>
<td>131.226528</td>
<td>-30.922765</td>
<td>1.9347</td>
<td>0.020291</td>
<td>...</td>
<td>15.309577</td>
<td>-38.666344</td>
<td>Fisher Domain</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>230 rows × 9 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save all our hard work to a csv file for more hacking to come!</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fv.to_csv(<span class="st">'../data/fv.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>This is often the point you receive the data in (if you are using any well-formed datasets). But in reality 90% of the time is doing weird data wrangling steps like what we have done. Then 9% is spent exploring your dataset and understanding it more, dealing with missing data, observing correlations. This is often an iterative process. Let’s do some simple visualisations.</p>
<p>Note: the last 1% of time is actually applying the ML algorithm!</p>
<p>Note2: These percentages are totally made up, but feeeel about right.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get information about index type and column types, non-null values and memory usage.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fv.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 230 entries, 0 to 229
Data columns (total 9 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   LONGITUDE  230 non-null    float64
 1   LATITUDE   230 non-null    float64
 2   res        230 non-null    float64
 3   faults     230 non-null    float64
 4   dem        228 non-null    float64
 5   mag        228 non-null    float64
 6   grav       228 non-null    float64
 7   geol       230 non-null    object 
 8   deposit    230 non-null    int64  
dtypes: float64(7), int64(1), object(1)
memory usage: 16.3+ KB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For nice easy data vis plots</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>missingNo <span class="op">=</span> fv.isnull().<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">0</span>).sort_values(ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>missingNo <span class="op">=</span> missingNo[missingNo.values  <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>missingNo</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>missingNo.values, y<span class="op">=</span>missingNo.index)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> upsetplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="op">=</span> missingNo.index[:<span class="dv">5</span>].tolist()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>missing_counts <span class="op">=</span> (fv.loc[:, missing_cols]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                  .isnull()</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                  .groupby(missing_cols)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                  .size())</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>upsetplot.plot(missing_counts)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot historgrams and scatter plots for each combination of features.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>sns.pairplot(fv,hue<span class="op">=</span><span class="st">'deposit'</span>,palette<span class="op">=</span><span class="st">"Set1"</span>,diag_kind<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot a heatmap for how correlated each of the features are</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> fv.corr() </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>            cmap<span class="op">=</span>plt.cm.BrBG, </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>            vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span><span class="va">True</span>, yticklabels<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="st">'res'</span>, <span class="st">'faults'</span>, <span class="st">'dem'</span>, <span class="st">'mag'</span>, <span class="st">'grav'</span>]:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.boxplot(x<span class="op">=</span><span class="st">'deposit'</span>,y<span class="op">=</span>i, data<span class="op">=</span>fv)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-48-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-48-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-48-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-48-output-5.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="machine-learning" class="level1">
<h1>Machine Learning</h1>
<p>We now have a clean dataset, we know a bit about, let’s try and measure some inferences.</p>
<section id="ml-classification" class="level3">
<h3 class="anchored" data-anchor-id="ml-classification">ML Classification</h3>
<p>This is where the ML classifier is defined. We can substitue our favourite ML technique here, and tune model variables as desired. As always the <a href="https://scikit-learn.org/stable/user_guide.html">scikit-learn documentation</a> is a great starting point to learn how these algorithms work.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the 'feature vector' and a 'target classification vector'</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>features<span class="op">=</span>fv.dropna().iloc[:,<span class="dv">2</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>targets<span class="op">=</span>fv.dropna().deposit</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>features.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>Index(['res', 'faults', 'dem', 'mag', 'grav', 'geol'], dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>numfts <span class="op">=</span> [<span class="st">'res'</span>, <span class="st">'faults'</span>, <span class="st">'dem'</span>, <span class="st">'mag'</span>, <span class="st">'grav'</span>]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>catfts <span class="op">=</span> [<span class="st">'geol'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> features.geol:</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(i, <span class="bu">str</span>):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the ML classifier with numerical and categorical data</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Scale, and replace missing values</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>numeric_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'imputer'</span>,SimpleImputer(missing_values<span class="op">=-</span><span class="fl">9999.</span>, strategy<span class="op">=</span><span class="st">'median'</span>)),</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'scaler'</span>, StandardScaler())])</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Encode categorical data and fill missing values with default 0</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>categorical_transformer <span class="op">=</span> Pipeline(steps<span class="op">=</span>[</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'imputer'</span>, SimpleImputer(strategy<span class="op">=</span><span class="st">'constant'</span>)),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'onehot'</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">'ignore'</span>))])</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine numerical and categorical data</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(transformers<span class="op">=</span>[</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'num'</span>, numeric_transformer, numfts),</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'cat'</span>, categorical_transformer, catfts)])</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Append classifier to preprocessing pipeline.</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have a full prediction pipeline.</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>                (<span class="st">'classifier'</span>, RandomForestClassifier(random_state<span class="op">=</span><span class="dv">1</span>))])</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>                <span class="co">#('classifier', MLPClassifier(solver='adam', alpha=0.001, max_iter=10000))])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Tranining the Clasifier...'</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>rf.fit(features,targets)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done RF. Now scoring..."</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(rf, features,targets, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RF 5-fold cross validation Scores:"</span>, scores)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCORE Mean: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.mean(scores), <span class="st">"STD: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.std(scores), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>plt.plot(targets.values,<span class="st">'b-'</span>,label<span class="op">=</span><span class="st">'Target (expected)'</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>plt.plot(rf.predict(features),<span class="st">'rx'</span>,label<span class="op">=</span><span class="st">'Prediction'</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Feature set"</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Target/Prediction"</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tranining the Clasifier...
Done RF. Now scoring...
RF 5-fold cross validation Scores: [0.95652174 0.84782609 0.93478261 0.97777778 0.77777778]
SCORE Mean: 0.90 STD: 0.07 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>&lt;matplotlib.legend.Legend at 0x293b9d970&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-54-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Features:"</span>,np.shape(features),<span class="st">"Targets:"</span>,np.shape(targets))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>rf.fit(features,targets)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(rf, features,targets, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RF CV-Scores: "</span>,scores)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CV-SCORE Mean: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.mean(scores), <span class="st">"STD: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.std(scores))</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#print("OOB score:",rf.steps[-1][1].oob_score_)</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Targets (expected result):"</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(targets.values)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Prediction (actual result):"</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rf.predict(features))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Features: (228, 6) Targets: (228,)
RF CV-Scores:  [0.95652174 0.84782609 0.93478261 0.97777778 0.77777778]
CV-SCORE Mean: 0.90 STD: 0.07
Targets (expected result):
[1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0]
Prediction (actual result):
[1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gather the importance measures</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ft_imp<span class="op">=</span>[]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>ft_lab<span class="op">=</span>[]</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,lab <span class="kw">in</span> <span class="bu">enumerate</span>(np.append(numfts,rf[<span class="st">'preprocessor'</span>].transformers_[<span class="dv">1</span>][<span class="dv">1</span>][<span class="st">'onehot'</span>].get_feature_names_out(catfts))):</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    ft_imp.append(rf.steps[<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>].feature_importances_[i])</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    ft_lab.append(lab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make the bar plot</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ft_imps, ft_labs <span class="op">=</span> (<span class="bu">list</span>(t) <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span><span class="bu">sorted</span>(<span class="bu">zip</span>(ft_imp,ft_lab))))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>datalength<span class="op">=</span><span class="bu">len</span>(ft_imp)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a new figure</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">10</span>))</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the bar graph</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>rects<span class="op">=</span>ax.barh(np.arange(<span class="dv">0</span>, datalength, step<span class="op">=</span><span class="dv">1</span>),ft_imps)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(np.arange(<span class="dv">0</span>, datalength, step<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(ft_labs)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Feature Importance'</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"From the Random Forest ML algorithm</span><span class="ch">\n</span><span class="st">these are the the most significant features for predicting the target bins.</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>From the Random Forest ML algorithm
these are the the most significant features for predicting the target bins.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-57-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="find-where-to-dig" class="level1">
<h1>Find where to dig!</h1>
<p>Now we have a trained model we can pass it NEW data, that is values for all the geopysical parameters, and it will give us a prediction for whether there is a deposit there or not. Simple.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>res1<span class="op">=</span> [<span class="fl">2.2</span>,<span class="fl">2.2</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>faults1 <span class="op">=</span> [<span class="fl">0.01</span>,<span class="fl">2.2</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>dem1 <span class="op">=</span> [<span class="dv">187</span>,<span class="fl">2.2</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>mag1<span class="op">=</span> [<span class="op">-</span><span class="dv">118</span>,<span class="fl">2.2</span>]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>grav <span class="op">=</span> [<span class="fl">1.8</span>,<span class="fl">2.2</span>]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>geol <span class="op">=</span> [<span class="st">'Crustal element Muloorina'</span>,<span class="st">'Crustal element Muloorina'</span>]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> pd.DataFrame({<span class="st">'res'</span>:res1,<span class="st">'faults'</span>:faults1,<span class="st">'dem'</span>:dem1,<span class="st">'mag'</span>:mag1,<span class="st">'grav'</span>:grav,<span class="st">'geol'</span>:geol})</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(targets)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#print(targets.reshape(1, -11))</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>rf.predict_proba(targets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   res  faults    dem    mag  grav                       geol
0  2.2    0.01  187.0 -118.0   1.8  Crustal element Muloorina
1  2.2    2.20    2.2    2.2   2.2  Crustal element Muloorina</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>array([[0.07, 0.93],
       [0.89, 0.11]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Better - Make a grid of target locations over an entire area</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#100x100 takes about 1 hour! 10x10 takes about 1 minute</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>grid_x, grid_y <span class="op">=</span> np.mgrid[<span class="dv">130</span>:<span class="dv">140</span>:<span class="ot">10j</span>,<span class="op">-</span><span class="dv">36</span>:<span class="op">-</span><span class="dv">26</span>:<span class="ot">10j</span>]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we want to get the geophys values for every single point on this grid</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Which we will then apply our model to!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>tdf <span class="op">=</span> pd.DataFrame({<span class="st">'LONGITUDE'</span>: grid_x.reshape(grid_x.size), <span class="st">'LATITUDE'</span>: grid_y.reshape(grid_y.size)})</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Res</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>indexes <span class="op">=</span> tdf.<span class="bu">apply</span>(</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treeres,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">10</span>,retval<span class="op">=</span><span class="st">'index'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'res'</span>] <span class="op">=</span> data_res.loc[indexes].resistivity.values</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done res"</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Faults</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'faults'</span>] <span class="op">=</span> tdf.<span class="bu">apply</span>(</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: coregPoint(treefaults,np.array([x.LONGITUDE, x.LATITUDE]),<span class="dv">100</span>,retval<span class="op">=</span><span class="st">'dists'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done faults"</span>)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Geophys</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'dem'</span>] <span class="op">=</span> rastersearch(tdf,z1,originx1,originy1,pixelx1,pixely1)</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'mag'</span>] <span class="op">=</span> rastersearch(tdf,z2,originx2,originy2,pixelx2,pixely2)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'grav'</span>] <span class="op">=</span> rastersearch(tdf,z3,originx3,originy3,pixelx3,pixely3)</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done rasters"</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Geology</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>tdf[<span class="st">'geol'</span>]<span class="op">=</span>tdf.<span class="bu">apply</span>(<span class="kw">lambda</span> x: shapeExplore(x.LONGITUDE, x.LATITUDE, shapesArch,recsArch,geoindex), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Done res
Done faults
Done rasters
Done!
CPU times: user 6.94 s, sys: 63.2 ms, total: 7.01 s
Wall time: 6.99 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save all our hard work to a csv file for more hacking to come!</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>tdf.to_csv(<span class="st">'../data/tdf_10.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#tdf.read_csv('data/tdf_100.csv') #Read the file in if you need</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply the trained ML to our gridded data to determine the probabilities at each of the points</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'RF...'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>pRF_map<span class="op">=</span>np.array(rf.predict_proba(tdf.iloc[:,<span class="dv">2</span>:]))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done RF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RF...
Done RF</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#X, Y = np.meshgrid(xi, yi)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>gridZ <span class="op">=</span> scipy.interpolate.griddata((tdf.LONGITUDE, tdf.LATITUDE), pRF_map[:,<span class="dv">1</span>], (grid_x, grid_y),method<span class="op">=</span><span class="st">'linear'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>im<span class="op">=</span>plt.pcolormesh(grid_x,grid_y,gridZ,cmap<span class="op">=</span><span class="st">'bwr'</span>,shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>ax.plot(xval,yval,<span class="st">'grey'</span>,linestyle<span class="op">=</span><span class="st">'--'</span>,linewidth<span class="op">=</span><span class="dv">1</span>,label<span class="op">=</span><span class="st">'SA'</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>ax.plot(fv[fv.deposit<span class="op">==</span><span class="dv">1</span>].LONGITUDE, fv[fv.deposit<span class="op">==</span><span class="dv">1</span>].LATITUDE, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">'y'</span>,label<span class="op">=</span>commname<span class="op">+</span><span class="st">" Deposits"</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>ax.plot(fv[fv.deposit<span class="op">==</span><span class="dv">0</span>].LONGITUDE, fv[fv.deposit<span class="op">==</span><span class="dv">0</span>].LATITUDE, </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'.'</span>, linestyle<span class="op">=</span><span class="st">''</span>,markersize<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'b'</span>,label<span class="op">=</span><span class="st">"Random Samples"</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">128.5</span>,<span class="fl">141.5</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">38.5</span>,<span class="op">-</span><span class="fl">25.5</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>cbaxes <span class="op">=</span> fig.add_axes([<span class="fl">0.40</span>, <span class="fl">0.18</span>, <span class="fl">0.2</span>, <span class="fl">0.015</span>])</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im, cax <span class="op">=</span> cbaxes,orientation<span class="op">=</span><span class="st">"horizontal"</span>)</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Probability of Mineral Depost'</span>, labelpad<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>cbar.ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03-ML_workflow_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

<p>All materials copyright Sydney Informatics Hub, University of Sydney</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>