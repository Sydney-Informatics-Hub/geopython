<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sydney Informatics Hub Python for Geoscience - Machine Learning for Geoscience</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../lesson.css">
</head>

<body class="nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub Python for Geoscience</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-setup" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Setup</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-setup">    
        <li>
    <a class="dropdown-item" href="../setup.html" rel="" target="">
 <span class="dropdown-text">Setup Instructions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/PathsEnvironments.html" rel="" target="">
 <span class="dropdown-text">Paths, Environments, and Notebooks</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">    
        <li>
    <a class="dropdown-item" href="../00-intro.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/01a-fundamentals.html" rel="" target="">
 <span class="dropdown-text">Fundamentals</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">    
        <li>
    <a class="dropdown-item" href="../notebooks/01b-dataframes.html" rel="" target="">
 <span class="dropdown-text">Useful Python packages for different data types</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-3" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-3">    
        <li>
    <a class="dropdown-item" href="../notebooks/02b-Clustering.html" rel="" target="">
 <span class="dropdown-text">Numerical Approaches</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/03-ML_workflow.html" rel="" target="">
 <span class="dropdown-text">Machine Learning Workflow</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-4" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Session 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-4">    
        <li>
    <a class="dropdown-item" href="../notebooks/04a-SimpleSpeedUps.html" rel="" target="">
 <span class="dropdown-text">Efficient Python Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/02a-mapping.html" rel="" target="">
 <span class="dropdown-text">Bonus: Matplotlib and Mapping with Cartopy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/03b-DeepLearningTS.html" rel="" target="">
 <span class="dropdown-text">Bonus: Deep Learning &amp; Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/04b-DaskDataframes.html" rel="" target="">
 <span class="dropdown-text">Bonus: Dask data frames</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/merge.html" rel="" target="">
 <span class="dropdown-text">Bonus: Merging Text Tables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/PDF2Python.html" rel="" target="">
 <span class="dropdown-text">Bonus: Working with PDF files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/text2segy.html" rel="" target="">
 <span class="dropdown-text">Bonus: segy2text2segy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/hdfeos.html" rel="" target="">
 <span class="dropdown-text">Bonus: HDF-EOS</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#questions" id="toc-questions" class="nav-link active" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#import-most-of-the-modules-we-need" id="toc-import-most-of-the-modules-we-need" class="nav-link" data-scroll-target="#import-most-of-the-modules-we-need">Import most of the modules we need</a></li>
  <li><a href="#load-in-the-data" id="toc-load-in-the-data" class="nav-link" data-scroll-target="#load-in-the-data">Load in the data</a></li>
  <li><a href="#perform-machine-learning-binary-classification." id="toc-perform-machine-learning-binary-classification." class="nav-link" data-scroll-target="#perform-machine-learning-binary-classification.">Perform Machine Learning binary classification.</a></li>
  <li><a href="#mapping-the-ml-result" id="toc-mapping-the-ml-result" class="nav-link" data-scroll-target="#mapping-the-ml-result">Mapping the ML result</a></li>
  <li><a href="#plotting-shapefiles-with-for-loops" id="toc-plotting-shapefiles-with-for-loops" class="nav-link" data-scroll-target="#plotting-shapefiles-with-for-loops">Plotting shapefiles with for loops</a></li>
  <li><a href="#cartopy-for-a-prettier-map" id="toc-cartopy-for-a-prettier-map" class="nav-link" data-scroll-target="#cartopy-for-a-prettier-map">Cartopy for a prettier map</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">Datasets</a>
  <ul class="collapse">
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points">Key points</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine Learning for Geoscience</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="questions" class="level3 questions">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<ul>
<li>What data science tools and techniques can be used in Python?</li>
<li>How do I do it?</li>
</ul>
</section>
<section id="objectives" class="level3 objectives">
<h3 class="anchored" data-anchor-id="objectives">Objectives</h3>
<ul>
<li>Learn fundamental Machine Learning packages.</li>
<li>Learn to further explore data.</li>
</ul>
</section>
<p>Let’s use some standard Machine Learning tools available in Python packages to analyse some data.</p>
<p>We have a dataset (from Butterworth et al.&nbsp;2016) with a collection of tectonomagmatic parameters associated with the time and location of porphyry copper deposits. We want to determine which of these (if any) parameters are geologically important (or at least statistically significant) in relation to the formation of porphyry coppers.</p>
<p>Below is an animation of the tectonomagmatic evolution of the South American plate margin since 150Ma, representing many of the parameters in the data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../fig/MullerConvergenceSmall.gif" title="segment" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">SegmentLocal</figcaption>
</figure>
</div>
<section id="import-most-of-the-modules-we-need" class="level2">
<h2 class="anchored" data-anchor-id="import-most-of-the-modules-we-need">Import most of the modules we need</h2>
<p>By convention module loads go at the top of your workflows.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="co">#For dealing with data structures</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co">#Data array manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="co">#Scientific Python, has lots of useful tools</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.io <span class="co">#A specific sub-module for input/output of sci data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#scikit-learn tools to perform machine learning classification</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#from sklearn import cross_validation</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#For making pretty figures</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#For easy geographic projections on a map</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#For dealing with shapefiles</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapefile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-in-the-data">Load in the data</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use pandas to load in the machine learning dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ml_data<span class="op">=</span>pandas.read_csv(<span class="st">"../data/ml_data_points.csv"</span>,index_col<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Print out the dataset so we can see what it looks like</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ml_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0 Present day longitude (degrees)</th>
<th data-quarto-table-cell-role="th">1 Present day latitude (degrees)</th>
<th data-quarto-table-cell-role="th">2 Reconstructed longitude (degrees)</th>
<th data-quarto-table-cell-role="th">3 Reconstructed latitude (degrees)</th>
<th data-quarto-table-cell-role="th">4 Age (Ma)</th>
<th data-quarto-table-cell-role="th">5 Time before mineralisation (Myr)</th>
<th data-quarto-table-cell-role="th">6 Seafloor age (Myr)</th>
<th data-quarto-table-cell-role="th">7 Segment length (km)</th>
<th data-quarto-table-cell-role="th">8 Slab length (km)</th>
<th data-quarto-table-cell-role="th">9 Distance to trench edge (km)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">11 Subducting plate parallel velocity (km/Myr)</th>
<th data-quarto-table-cell-role="th">12 Overriding plate normal velocity (km/Myr)</th>
<th data-quarto-table-cell-role="th">13 Overriding plate parallel velocity (km/Myr)</th>
<th data-quarto-table-cell-role="th">14 Convergence normal rate (km/Myr)</th>
<th data-quarto-table-cell-role="th">15 Convergence parallel rate (km/Myr)</th>
<th data-quarto-table-cell-role="th">16 Subduction polarity (degrees)</th>
<th data-quarto-table-cell-role="th">17 Subduction obliquity (degrees)</th>
<th data-quarto-table-cell-role="th">18 Distance along margin (km)</th>
<th data-quarto-table-cell-role="th">19 Subduction obliquity signed (radians)</th>
<th data-quarto-table-cell-role="th">20 Ore Deposits Binary Flag (1 or 0)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-66.28</td>
<td>-27.37</td>
<td>-65.264812</td>
<td>-28.103781</td>
<td>6.0</td>
<td>0.0</td>
<td>48.189707</td>
<td>56.08069</td>
<td>2436.30907</td>
<td>2436.30907</td>
<td>...</td>
<td>40.63020</td>
<td>-17.43987</td>
<td>12.20271</td>
<td>102.31471</td>
<td>28.82518</td>
<td>5.67505</td>
<td>15.73415</td>
<td>2269.19769</td>
<td>0.274613</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-69.75</td>
<td>-30.50</td>
<td>-67.696759</td>
<td>-31.970639</td>
<td>12.0</td>
<td>0.0</td>
<td>52.321162</td>
<td>56.09672</td>
<td>2490.68735</td>
<td>2490.68735</td>
<td>...</td>
<td>39.60199</td>
<td>-22.80622</td>
<td>13.40127</td>
<td>115.35820</td>
<td>27.39401</td>
<td>5.78937</td>
<td>13.35854</td>
<td>1823.34107</td>
<td>0.233151</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-66.65</td>
<td>-27.27</td>
<td>-65.128689</td>
<td>-28.374772</td>
<td>9.0</td>
<td>0.0</td>
<td>53.506085</td>
<td>55.77705</td>
<td>2823.54951</td>
<td>2823.54951</td>
<td>...</td>
<td>45.32425</td>
<td>-18.08485</td>
<td>11.27500</td>
<td>100.24282</td>
<td>34.62444</td>
<td>8.97218</td>
<td>19.05520</td>
<td>2269.19769</td>
<td>0.332576</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-66.61</td>
<td>-27.33</td>
<td>-65.257928</td>
<td>-28.311094</td>
<td>8.0</td>
<td>0.0</td>
<td>51.317135</td>
<td>55.90088</td>
<td>2656.71724</td>
<td>2656.71724</td>
<td>...</td>
<td>43.13319</td>
<td>-17.78538</td>
<td>11.72618</td>
<td>101.21965</td>
<td>31.92962</td>
<td>7.42992</td>
<td>17.50782</td>
<td>2269.19769</td>
<td>0.305569</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-66.55</td>
<td>-27.40</td>
<td>-65.366917</td>
<td>-28.257580</td>
<td>7.0</td>
<td>0.0</td>
<td>49.340097</td>
<td>56.09011</td>
<td>2547.29585</td>
<td>2547.29585</td>
<td>...</td>
<td>40.57322</td>
<td>-17.43622</td>
<td>12.23778</td>
<td>102.25748</td>
<td>28.80235</td>
<td>5.65657</td>
<td>15.73067</td>
<td>2269.19769</td>
<td>0.274552</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">296</td>
<td>-78.67</td>
<td>-6.73</td>
<td>-70.657487</td>
<td>-11.057387</td>
<td>39.0</td>
<td>0.0</td>
<td>62.727249</td>
<td>56.14919</td>
<td>5373.67650</td>
<td>1076.30110</td>
<td>...</td>
<td>13.21524</td>
<td>-25.08597</td>
<td>12.24246</td>
<td>60.45651</td>
<td>-7.46828</td>
<td>-22.30925</td>
<td>7.04216</td>
<td>4708.08568</td>
<td>-0.122909</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">297</td>
<td>-75.09</td>
<td>-13.69</td>
<td>-37.112536</td>
<td>-19.124363</td>
<td>121.0</td>
<td>0.0</td>
<td>30.740063</td>
<td>54.09642</td>
<td>269.79929</td>
<td>269.79929</td>
<td>...</td>
<td>-39.68330</td>
<td>11.56758</td>
<td>7.99788</td>
<td>-19.41449</td>
<td>-59.05957</td>
<td>-46.36908</td>
<td>71.80290</td>
<td>3761.82099</td>
<td>1.253197</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">298</td>
<td>-71.31</td>
<td>-14.91</td>
<td>-38.398992</td>
<td>-21.934657</td>
<td>151.0</td>
<td>0.0</td>
<td>17.739843</td>
<td>53.93117</td>
<td>323.86191</td>
<td>323.86191</td>
<td>...</td>
<td>-3.42257</td>
<td>-17.25992</td>
<td>-22.78837</td>
<td>8.88338</td>
<td>-7.68381</td>
<td>-40.99490</td>
<td>40.85864</td>
<td>3378.69739</td>
<td>-0.713118</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>-70.61</td>
<td>-17.25</td>
<td>-37.243172</td>
<td>-24.160112</td>
<td>145.0</td>
<td>0.0</td>
<td>11.744395</td>
<td>53.94534</td>
<td>163.59542</td>
<td>163.59542</td>
<td>...</td>
<td>-2.26253</td>
<td>14.87833</td>
<td>0.05195</td>
<td>2.36178</td>
<td>-23.78566</td>
<td>-38.97366</td>
<td>84.32944</td>
<td>3160.06366</td>
<td>-1.471826</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">300</td>
<td>-76.13</td>
<td>-11.60</td>
<td>-43.993914</td>
<td>-16.965040</td>
<td>101.0</td>
<td>0.0</td>
<td>35.880790</td>
<td>54.85460</td>
<td>1190.90698</td>
<td>1190.90698</td>
<td>...</td>
<td>40.29418</td>
<td>-31.96652</td>
<td>41.93348</td>
<td>71.76161</td>
<td>-29.57451</td>
<td>-38.50603</td>
<td>22.39762</td>
<td>4093.90633</td>
<td>-0.390912</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>301 rows × 21 columns</p>
</div>
</div>
</div>
<p>There are 21 columns (python (usually) counts from 0) representing different parameters. Some of these parameters may be useful for us. Some are not. The final column contains a binary flag representing whether there is a known porphyry copper deposit at that location or not. The “non-deposits” are required to train our Machine Learning classifier what a porphyry deposit looks like, and also, what a porphyry deposit doesn’t look like!</p>
</section>
<section id="perform-machine-learning-binary-classification." class="level2">
<h2 class="anchored" data-anchor-id="perform-machine-learning-binary-classification.">Perform Machine Learning binary classification.</h2>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Change data format to numpy array for easy manipulation</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ml_data_np<span class="op">=</span>ml_data.values</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Set the indices of the parameters (features) to include in the ML</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#params=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively try include any set of features you'd like to include!</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#params=[6,9,14,17] </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span>[<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>] </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Save the number of parameters we have chosen</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>datalength<span class="op">=</span><span class="bu">len</span>(params)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalise the data for Machine Learning</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>ml_data_norm<span class="op">=</span>preprocessing.scale(ml_data_np[:,params])</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a 'feature vector' and a 'target classification vector'</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>features<span class="op">=</span>ml_data_norm</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>targets<span class="op">=</span>ml_data_np[:,<span class="dv">20</span>]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Print out some info about our final dataset</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Shape of ML data array: "</span>, ml_data_norm.shape)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Positive (deposits) examples: "</span>,np.shape(ml_data_np[ml_data_np[:,<span class="dv">20</span>]<span class="op">==</span><span class="dv">1</span>,:]))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Negative (non-deposits) examples: "</span>,np.shape(ml_data_np[ml_data_np[:,<span class="dv">20</span>]<span class="op">==</span><span class="dv">0</span>,:]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape of ML data array:  (301, 4)
Positive (deposits) examples:  (147, 21)
Negative (non-deposits) examples:  (154, 21)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Make the classifiers'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Random Forest...'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create and train the random forest</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#multi-core CPUs can use: rf = RandomForestClassifier(n_estimators=100, n_jobs=2)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#n_estimators use between 64-128 doi: 10.1007/978-3-642-31537-4_13</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">128</span>, n_jobs<span class="op">=</span><span class="dv">1</span>,class_weight<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>rf.fit(features,targets)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done RF"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> cross_val_score(rf, features,targets, cv<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RF Scores: "</span>,scores)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCORE Mean: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.mean(scores), <span class="st">"STD: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> np.std(scores), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Targets (expected result):"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(targets)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Prediction (actual result):"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rf.predict(features))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Make the classifiers
Random Forest...
Done RF
RF Scores:  [0.74193548 0.8        0.63333333 0.73333333 0.76666667 0.6
 0.4        0.66666667 0.76666667 0.66666667]
SCORE Mean: 0.68 STD: 0.11 

Targets (expected result):
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
Prediction (actual result):
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 0. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 0. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a list of labels for our chosen features</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>paramColumns<span class="op">=</span>np.array(ml_data.columns)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>paramLabels<span class="op">=</span>paramColumns[params].tolist()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a new figure</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the bar graph</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>rects<span class="op">=</span>ax.barh(np.arange(<span class="dv">0</span>, datalength, step<span class="op">=</span><span class="dv">1</span>),rf.feature_importances_)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Label the axes</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(np.arange(<span class="dv">0</span>, datalength, step<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(paramLabels)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Feature Importance'</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Print the feature importance to compare with plot</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision<span class="op">=</span><span class="dv">3</span>,suppress<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Importance </span><span class="ch">\t</span><span class="st"> Feature"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,label <span class="kw">in</span> <span class="bu">enumerate</span>(paramLabels):</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="sc">%1.3f</span><span class="st"> </span><span class="ch">\t\t</span><span class="st"> </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> (rf.feature_importances_[i],label))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance   Feature
0.305        16 Subduction polarity (degrees)
0.295        17 Subduction obliquity (degrees)
0.142        18 Distance along margin (km)
0.257        19 Subduction obliquity signed (radians)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03a-MachineLearning_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Now if we can measure the tectonomagmatic properties at some point. Based on our trained classifier we can predict a probability that porphyry copper deposits have formed</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply the trained ML to our gridded data to determine the probabilities at each of the points</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'RF...'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>pRF<span class="op">=</span>np.array(rf.predict_proba(features))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done RF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RF...
Done RF</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now you have a working ML model. You can use NEW DATA (you go and collect in the field or whatever)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#to make predictions</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>newdata <span class="op">=</span> np.array([[<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.6</span>, <span class="op">-</span><span class="fl">0.7</span>,  <span class="fl">0.2</span>]])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>rf.predict_proba(newdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([[0.75, 0.25]])</code></pre>
</div>
</div>
</section>
<section id="mapping-the-ml-result" class="level2">
<h2 class="anchored" data-anchor-id="mapping-the-ml-result">Mapping the ML result</h2>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>filename<span class="op">=</span><span class="st">"../data/topodata.nc"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> scipy.io.netcdf.netcdf_file(filename,<span class="st">'r'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>data.variables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1b/_jymrbj17cz6t7cxdl86xshh0000gr/T/ipykernel_40834/2264377247.py:2: DeprecationWarning: Please use `netcdf_file` from the `scipy.io` namespace, the `scipy.io.netcdf` namespace is deprecated.
  data = scipy.io.netcdf.netcdf_file(filename,'r')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'X': &lt;scipy.io._netcdf.netcdf_variable at 0x1391686d0&gt;,
 'Y': &lt;scipy.io._netcdf.netcdf_variable at 0x139304f70&gt;,
 'elev': &lt;scipy.io._netcdf.netcdf_variable at 0x139281c40&gt;}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>topoX<span class="op">=</span>data.variables[<span class="st">'X'</span>][:]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>topoY<span class="op">=</span>data.variables[<span class="st">'Y'</span>][:]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>topoZ<span class="op">=</span>np.array(data.variables[<span class="st">'elev'</span>][:])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Some file types and readers (like netcdf) can actually change the data directly on disk</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Good practice, is to close the file when done (for safety and memory saving)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>data.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/darya/miniconda3/envs/geopy/lib/python3.9/site-packages/scipy/io/_netcdf.py:304: RuntimeWarning: Cannot close a netcdf_file opened with mmap=True, when netcdf_variables or arrays referring to its data still exist. All data arrays obtained from such files refer directly to data on disk, and must be copied before the file can be cleanly closed. (See netcdf_file docstring for more information on mmap.)
  warnings.warn((</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a figure object</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the axes of the current figure, for manipulation</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Put down the main topography dataset</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>im<span class="op">=</span>ax.imshow(topoZ,vmin<span class="op">=-</span><span class="dv">5000</span>,vmax<span class="op">=</span><span class="dv">1000</span>,extent<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">360</span>,<span class="op">-</span><span class="dv">90</span>,<span class="dv">90</span>],origin<span class="op">=</span><span class="st">'upper'</span>,aspect<span class="op">=</span><span class="dv">1</span>,cmap<span class="op">=</span>cm.gist_earth)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a colorbar</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>cbar<span class="op">=</span>plt.colorbar(im,fraction<span class="op">=</span><span class="fl">0.025</span>,pad<span class="op">=</span><span class="fl">0.05</span>,ticks<span class="op">=</span>[<span class="op">-</span><span class="dv">5000</span>,<span class="dv">0</span>, <span class="dv">1000</span>],extend<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Height </span><span class="ch">\n</span><span class="st"> ASL </span><span class="ch">\n</span><span class="st"> (m)'</span>, rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Clean up the default axis ticks</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>plt.yticks([<span class="op">-</span><span class="dv">90</span>,<span class="op">-</span><span class="dv">45</span>,<span class="dv">0</span>,<span class="dv">45</span>,<span class="dv">90</span>])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">90</span>,<span class="dv">180</span>,<span class="dv">270</span>,<span class="dv">360</span>])</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Put labels on the figure</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Longitude'</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Latitude'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Put a title on it</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bathymetry and Topography of the World </span><span class="ch">\n</span><span class="st"> (ETOPO5 2020)"</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03a-MachineLearning_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="plotting-shapefiles-with-for-loops" class="level2">
<h2 class="anchored" data-anchor-id="plotting-shapefiles-with-for-loops">Plotting shapefiles with for loops</h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load in plate polygons for plotting</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>topologyFile<span class="op">=</span><span class="st">'../data/platepolygons/topology_platepolygons_0.00Ma.shp'</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the file</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>shapeRead <span class="op">=</span> shapefile.Reader(topologyFile)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#And save out some of the shape file attributes</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>recs    <span class="op">=</span> shapeRead.records()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>shapes  <span class="op">=</span> shapeRead.shapes()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>fields  <span class="op">=</span> shapeRead.fields</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>Nshp    <span class="op">=</span> <span class="bu">len</span>(shapes)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, nshp <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">range</span>(Nshp)):</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#if nshp!=35 and nshp!=36 and nshp!=23:</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#These are the plates that cross the dateline and cause </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">#banding errors</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        polygonShape<span class="op">=</span>shapes[nshp].points</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        poly<span class="op">=</span>np.array(polygonShape)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        plt.plot(poly[:,<span class="dv">0</span>], poly[:,<span class="dv">1</span>], c<span class="op">=</span><span class="st">'k'</span>,zorder<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="03a-MachineLearning_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="cartopy-for-a-prettier-map" class="level2">
<h2 class="anchored" data-anchor-id="cartopy-for-a-prettier-map">Cartopy for a prettier map</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">###Set up the figure</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">12</span>),dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.PlateCarree())</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">85</span>, <span class="op">-</span><span class="dv">30</span>, <span class="op">-</span><span class="dv">55</span>, <span class="dv">10</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax.coastlines(<span class="st">'50m'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">###Add the map grid lines and format them</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>gl <span class="op">=</span> ax.gridlines(crs<span class="op">=</span>ccrs.PlateCarree(), draw_labels<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                  linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cartopy.mpl.gridliner <span class="im">import</span> LONGITUDE_FORMATTER, LATITUDE_FORMATTER</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colorbar, colors</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>gl.top_labels <span class="op">=</span> <span class="va">False</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>gl.left_labels <span class="op">=</span> <span class="va">True</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>gl.right_labels <span class="op">=</span> <span class="va">False</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>gl.xlines <span class="op">=</span> <span class="va">False</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>gl.ylines <span class="op">=</span> <span class="va">False</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>gl.xlocator <span class="op">=</span> mticker.FixedLocator([<span class="op">-</span><span class="dv">75</span>,<span class="op">-</span><span class="dv">60</span>, <span class="op">-</span><span class="dv">45</span>,<span class="op">-</span><span class="dv">30</span>])</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>gl.ylocator <span class="op">=</span> mticker.FixedLocator([<span class="op">-</span><span class="dv">60</span>, <span class="op">-</span><span class="dv">45</span>, <span class="op">-</span><span class="dv">30</span>, <span class="op">-</span><span class="dv">15</span>, <span class="dv">0</span>,<span class="dv">15</span>])</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>gl.xformatter <span class="op">=</span> LONGITUDE_FORMATTER</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>gl.yformatter <span class="op">=</span> LATITUDE_FORMATTER</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#gl.xlabel_style = {'size': 15, 'color': 'gray'}</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#gl.xlabel_style = {'color': 'black', 'weight': 'normal'}</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Made base map"</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">###Plot a topography underlay image</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a lat lon grid to fit the topo grid</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>lons, lats <span class="op">=</span> np.meshgrid(topoX,topoY)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>im1<span class="op">=</span>ax.pcolormesh(lons,lats,topoZ, shading<span class="op">=</span><span class="st">"auto"</span>,cmap<span class="op">=</span>plt.cm.gist_earth,transform<span class="op">=</span>ccrs.PlateCarree())              </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>cbar<span class="op">=</span>plt.colorbar(im1, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">"horizontal"</span>, pad<span class="op">=</span><span class="fl">0.01</span>, fraction<span class="op">=</span><span class="fl">0.05</span>, shrink<span class="op">=</span><span class="fl">0.2</span>,extend<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Topography (m)'</span>)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Added topo"</span>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">###Plot shapefile polygon outlines</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Load in plate polygons for plotting</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>topologyFile<span class="op">=</span><span class="st">'../data/platepolygons/topology_platepolygons_0.00Ma.shp'</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the file</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>shapeRead <span class="op">=</span> shapefile.Reader(topologyFile)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="co">#And save out some of the shape file attributes</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>recs    <span class="op">=</span> shapeRead.records()</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>shapes  <span class="op">=</span> shapeRead.shapes()</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>fields  <span class="op">=</span> shapeRead.fields</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>Nshp    <span class="op">=</span> <span class="bu">len</span>(shapes)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, nshp <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">range</span>(Nshp)):</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> nshp<span class="op">!=</span><span class="dv">35</span> <span class="kw">and</span> nshp<span class="op">!=</span><span class="dv">36</span> <span class="kw">and</span> nshp<span class="op">!=</span><span class="dv">23</span>:</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">#These are the plates that cross the dateline and cause </span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">#banding errors</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        polygonShape<span class="op">=</span>shapes[nshp].points</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>        poly<span class="op">=</span>np.array(polygonShape)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        xh<span class="op">=</span>poly[:,<span class="dv">0</span>]</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        yh<span class="op">=</span>poly[:,<span class="dv">1</span>]</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>        ax.plot(xh, yh, c<span class="op">=</span><span class="st">'w'</span>,zorder<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Added shapes"</span>)</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="co">###Plot the ore deposit probability</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>xh <span class="op">=</span> ml_data_np[ml_data_np[:,<span class="op">-</span><span class="dv">1</span>]<span class="op">==</span><span class="dv">1</span>,<span class="dv">0</span>]</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>yh<span class="op">=</span> ml_data_np[ml_data_np[:,<span class="op">-</span><span class="dv">1</span>]<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> ax.scatter(xh, yh, <span class="dv">500</span>, marker<span class="op">=</span><span class="st">'.'</span>,c<span class="op">=</span>pRF[:<span class="dv">147</span>,<span class="dv">1</span>],cmap<span class="op">=</span>plt.cm.copper,zorder<span class="op">=</span><span class="dv">3</span>,transform<span class="op">=</span>ccrs.PlateCarree(),vmin<span class="op">=</span><span class="dv">0</span>,vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="co">#l2 = pmap.scatter(xh, yh, 20, marker='.',edgecolor='dimgrey',linewidth=0.5,c=pRF[:147,1],cmap=plt.cm.copper,zorder=3)</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>cbar<span class="op">=</span>fig.colorbar(l2, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">"horizontal"</span>, pad<span class="op">=</span><span class="fl">0.05</span>, fraction<span class="op">=</span><span class="fl">0.05</span>, shrink<span class="op">=</span><span class="fl">0.2</span>,ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="fl">1.0</span>])</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>l2.set_clim(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Prediction Probability (%)'</span>)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="co">###Plot the ore deposit Age</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>xh<span class="op">=</span>ml_data_np[ml_data_np[:,<span class="op">-</span><span class="dv">1</span>]<span class="op">==</span><span class="dv">1</span>,<span class="dv">0</span>]</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>yh <span class="op">=</span> ml_data_np[ml_data_np[:,<span class="op">-</span><span class="dv">1</span>]<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> ax.scatter(xh, yh, <span class="dv">50</span>, marker<span class="op">=</span><span class="st">'.'</span>,c<span class="op">=</span>ml_data_np[ml_data_np[:,<span class="op">-</span><span class="dv">1</span>]<span class="op">==</span><span class="dv">1</span>,<span class="dv">4</span>],cmap<span class="op">=</span>plt.cm.hsv,zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>cbar<span class="op">=</span>fig.colorbar(l2, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">"horizontal"</span>, pad<span class="op">=</span><span class="fl">0.1</span>, fraction<span class="op">=</span><span class="fl">0.05</span>, shrink<span class="op">=</span><span class="fl">0.2</span>,extend<span class="op">=</span><span class="st">'max'</span>,ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">150</span>])</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>l2.set_clim(<span class="dv">0</span>, <span class="dv">170</span>)</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Age of Deposit (Ma)'</span>)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Added deposit probability"</span>)</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Made base map
Added topo
Added shapes
Added deposit probability</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="03a-MachineLearning_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="exercise" class="level2">
<h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<p>Do the same analysis but using a different Machine Learning algorithm for your classification. You can use this as a guide for picking a good classification algorithm <a href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html</a>. Present your results on a map, and compare it with the Random Forest method.</p>
</section>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Datasets</h2>
<section id="topographybathymetry" class="level4">
<h4 class="anchored" data-anchor-id="topographybathymetry">Topography/Bathymetry</h4>
<p>WORLDBATH: ETOPO5 5x5 minute Navy bathymetry. http://iridl.ldeo.columbia.edu/SOURCES/.NOAA/.NGDC/.ETOPO5/</p>
</section>
<section id="ml-dataset" class="level4">
<h4 class="anchored" data-anchor-id="ml-dataset">ML dataset</h4>
<p>Butterworth et al 2016 https://doi.org/10.1002/2016TC004289</p>
</section>
<section id="shapefile-plate-polygons" class="level4">
<h4 class="anchored" data-anchor-id="shapefile-plate-polygons">Shapefile plate polygons</h4>
<p>GPlates2.0. https://www.gplates.org/</p>
</section>
<section id="key-points" class="level3 keypoints">
<h3 class="anchored" data-anchor-id="key-points">Key points</h3>
<ul>
<li>Applying ML workflows</li>
<li>Wrangling data.</li>
</ul>
</section>


</section>

<p>All materials copyright Sydney Informatics Hub, University of Sydney</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>